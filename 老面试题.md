activity ç”Ÿå‘½å‘¨æœŸ

onCreate() -\> onStart() -\> onResume() -\> onPause() -\> onStop() -\>
onDetroy() c s r p s d

android:configChanges

fragment ç”Ÿå‘½å‘¨æœŸ

onAttach() onCreate() onCreateView() onActivityCreated() onStart()
onResume() onPause() onStop() onDestroyView() onDestroy() onDetach()

Serviceç”Ÿå‘½å‘¨æœŸ

     startService  startService() --> onCreate()--> onStartConmon()--> onDestroy()ã€‚ csd

è®°å¿† ï¼Œ

bindService
bindService--\>onCreate()--\>onBind()--\>unBind()--\>onDestroy(ï¼‰cbbd

Startservice bindservice åŒºåˆ«

Startservice

å®ç°æ–¹æ³•ï¼šIntent intent = new Intent(this, MyService.class);

startService(intent); è‡ªå®šä¹‰ä¸€ä¸ªmyservie ç»§æ‰¿ Service ï¼Œ
åœ¨onStartCommand æ–¹æ³•ä¸­æ‰§è¡Œåå°ä»»åŠ¡ã€‚

serviceä¼šä¸€ç›´æ— é™æœŸè¿è¡Œä¸‹å»ï¼Œåªæœ‰å¤–éƒ¨è°ƒç”¨äº†stopService()æˆ–stopSelf()æ–¹æ³•æ—¶æ‰åœæ­¢ã€‚

.bindservice

æ­¥éª¤ï¼š

1,å®¢æˆ·ç«¯å‘èµ·ç»‘å®šè¯·æ±‚ bindService(intent, serviceConnection,
Context.BIND_AUTO_CREATE);

2,Service æä¾› IBinder å¯¹è±¡

public class MyService extends Service {

    private final IBinder binder = new MyBinder();

    public class MyBinder extends Binder {

        public MyService getService() {

            return MyService.this; // è¿”å›å½“å‰Serviceå®ä¾‹

        }

    }



    @Nullable

    @Override

    public IBinder onBind(Intent intent) {

        return binder; // è¿”å›IBinderå¯¹è±¡

    }

}

3,å®¢æˆ·ç«¯é€šè¿‡ ServiceConnection æ‹¿åˆ° Binder

private MyService myService;

private boolean bound = false;

private ServiceConnection connection = new ServiceConnection() {

    @Override

    public void onServiceConnected(ComponentName name, IBinder service) {

        MyService.MyBinder binder = (MyService.MyBinder) service;

        myService = binder.getService(); // æ‹¿åˆ°Serviceå®ä¾‹

        bound = true;

    }



    @Override

    public void onServiceDisconnected(ComponentName name) {

        bound = false;

    }

};

4,å®¢æˆ·ç«¯è°ƒç”¨ Service æ–¹æ³•

ç°åœ¨å°±èƒ½ç›´æ¥é€šä¿¡äº†ï¼š

if (bound) {

    myService.playMusic(); // ç›´æ¥è°ƒç”¨Serviceé‡Œçš„æ–¹æ³•

}

1,bindservice å®¢æœæ¨¡å¼ï¼ŒæœåŠ¡ä¸€ä¸ªï¼Œå®¢æˆ·ç«¯å¯å¤šä¸ªã€‚
2.clientå¯ä»¥é€šè¿‡IBinderæ¥å£è·å–Serviceå®ä¾‹ï¼Œä»è€Œå®ç°åœ¨clientç«¯ç›´æ¥è°ƒç”¨Serviceä¸­çš„æ–¹æ³•ä»¥å®ç°çµæ´»äº¤äº’

3.bindServiceå¯åŠ¨æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸä¸å…¶ç»‘å®šçš„clientæ¯æ¯ç›¸å…³ã€‚å½“clienté”€æ¯æ—¶ï¼Œclientä¼šè‡ªåŠ¨ä¸Serviceè§£é™¤ç»‘å®šã€‚å½“ç„¶ï¼Œclientä¹Ÿå¯ä»¥æ˜ç¡®è°ƒç”¨Contextçš„unbindService()æ–¹æ³•ä¸Serviceè§£é™¤ç»‘å®šã€‚å½“æ²¡æœ‰ä»»ä½•clientä¸Serviceç»‘å®šæ—¶ï¼ŒServiceä¼šè‡ªè¡Œé”€æ¯ã€‚

Broadcastæ³¨å†Œæ–¹å¼ä¸åŒºåˆ«Â 

    é™æ€æ³¨å†Œï¼ˆå¸¸é©»ï¼‰ Androidmanifest.xml  å¼€æœºå¯åŠ¨ ï¼Œ ä¸æ­»

åŠ¨æ€æ³¨å†Œ registerReceiver

å¹¿æ’­çš„ç±»å‹ï¼ˆéå¸¸é‡è¦ï¼‰

ä¸¤ä¸ª activity ä¼ é€’å¤§çš„æ•°æ®

Activityä¹‹é—´é€šè¿‡intentä¼ é€’å¤§é‡æ•°æ®ï¼Œå¯¼è‡´æ–°Activityæ— æ³•å¯åŠ¨ã€‚æ¯”å¦‚ä½ ç”¨
intent åŠ  bundle ï¼Œ ä¼šå‡ºç°ä¼  è¾“æ•°æ®è¿‡å¤§å¼‚å¸¸ ï¼Œ

æ–¹æ¡ˆä¸€ï¼šç”¨å…¨å±€å•ä¾‹ / Application ä¿å­˜ä¸´æ—¶æ•°æ®

è¿™ç§æ–¹å¼æœ€ç®€å•ã€æœ€å¸¸è§ã€‚

æ–¹æ¡ˆäºŒï¼šä½¿ç”¨æ–‡ä»¶æˆ–æ•°æ®åº“ç¼“å­˜

æŠŠå¤§æ•°æ®ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ / SQLite / Roomä¸­ï¼Œåªåœ¨ Intent ä¸­ä¼ ä¸€ä¸ªè·¯å¾„æˆ–
IDã€‚

æ¡ˆä¸‰ï¼šä½¿ç”¨ ViewModelï¼ˆåœ¨åŒä¸€ä¸ª Task å†…ï¼‰

å¦‚æœä¸¤ä¸ª Activity æ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹ã€åŒä¸€ä¸ª Task å†…ï¼Œå¯ä»¥å€ŸåŠ©
ViewModelStoreOwner ï¼ˆJetpackï¼‰ã€‚é€šè¿‡å…±äº« ViewModel å­˜å‚¨æ•°æ®ï¼Œ

æ–¹æ¡ˆå››ï¼šä½¿ç”¨ ParcelableFileDescriptorï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰

å¦‚æœç¡®å®è¦ä¼ è¾“å¤§æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ–‡ä»¶å¥æŸ„ï¼ˆParcelFileDescriptorï¼‰ä¼ é€’ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•°ç»„ï¼š

Activityä¹‹é—´ä¼ é€’æ•°æ®ä¸€èˆ¬é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°ï¼š

1.  é€šè¿‡intentä¼ é€’æ•°æ®

2.  é€šè¿‡Application

3.  ä½¿ç”¨å•ä¾‹

4.  é™æ€æˆå‘˜å˜é‡ã€‚ï¼ˆå¯ä»¥è€ƒè™‘Â WeakReferencesï¼‰

5.  æŒä¹…åŒ–ï¼ˆsqliteã€share preferenceã€fileç­‰ï¼‰

https://blog.csdn.net/rflyee/article/details/47431633

å››ç§LaunchModeåŠå…¶ä½¿ç”¨åœºæ™¯

standard æ¨¡å¼ ï¼šéƒ½ä¼šé‡æ–°åˆ›å»ºActivityçš„æ–°çš„å®ä¾‹
ï¼Œä¸éœ€è¦è€ƒè™‘è¿™ä¸ªå®ä¾‹æ˜¯å¦å·²ç»å­˜åœ¨ã€‚

singleTop æ¨¡å¼ ï¼šåœ¨æ ˆé¡¶å°±ä¸èµ°oncreate ï¼Œè°ƒç”¨onNewIntent
ï¼Œä¸å»åˆ›å»ºè¿™ä¸ªå®ä¾‹

singleTask æ¨¡å¼ ï¼šåœ¨ä¸€ä¸ªtaskä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹
ï¼Œç³»ç»Ÿå°±ä¼šæŠŠè¯¥Activityç§»åˆ°æ ˆé¡¶ï¼Œå¹¶æŠŠå®ƒä¸Šé¢ çš„ activityå‡ºæ ˆã€‚

singleInstance æ¨¡å¼ ï¼š singleInstance
Activityåœ¨æ•´ä¸ªç³»ç»Ÿé‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¯åŠ¨ä¸€
singleInstanceActivityæ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡æ ˆï¼Œå¹¶ä¸”è¿™ä¸ªä»»åŠ¡æ ˆåªæœ‰ä»–ä¸€ä¸ªActivityã€‚

Activity ä¿å­˜æ•°æ®

onSaveInstanceState(Bundle)ä¼šåœ¨activityè½¬å…¥åå°çŠ¶æ€ä¹‹å‰è¢«è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯onStop()æ–¹æ³•
ä¹‹å‰ï¼Œ onPauseæ–¹æ³•ä¹‹åè¢«è°ƒç”¨ onRestoreInstanceStateä»ä¸­æå–ä¿å­˜å¥½çš„æ•°æ®

ä½¿ç”¨Â ViewModelÂ ä¿å­˜çŠ¶æ€ï¼ˆæ¨èç”¨äºé…ç½®å˜æ›´ï¼‰

ï‚·ä½œç”¨ï¼šViewModelÂ çš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äº
Activityï¼Œä¸å—é…ç½®å˜æ›´å½±å“ï¼ˆæ—‹è½¬å±å¹•æ—¶ä¸ä¼šé‡å»ºï¼‰ï¼Œé€‚åˆä¿å­˜å¤æ‚æ•°æ®æˆ–ä¸ç•Œé¢ç›¸å…³çš„çŠ¶æ€ã€‚

ï‚·é€‚ç”¨åœºæ™¯ï¼šåˆ—è¡¨æ•°æ®ã€ç½‘ç»œè¯·æ±‚ç»“æœã€ç”¨æˆ·è¾“å…¥çŠ¶æ€ç­‰ã€‚

ç®€è¿°AIDLæœºåˆ¶Â 

1,å®šä¹‰ AIDL æ¥å£æ–‡ä»¶

åœ¨ app/src/main/aidl/ ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª .aidl æ–‡ä»¶ï¼š

// IMyAidlInterface.aidl

package com.example.aidl;

interface IMyAidlInterface {

    int add(int a, int b);

    String getMessage();

}

âš ï¸ æ³¨æ„ï¼š

AIDL æ–‡ä»¶ä¸­çš„åŒ…åå¿…é¡»ä¸å®ç°ç±»ä¿æŒä¸€è‡´ã€‚

ğŸ”¹ 2. ç¼–è¯‘ç”Ÿæˆ Java æ¥å£æ–‡ä»¶

ç¼–è¯‘åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨ build/generated/aidl_source_output_dir/ ä¸‹ç”Ÿæˆä¸€ä¸ª
Java æ¥å£ï¼š

public interface IMyAidlInterface extends android.os.IInterface {

    public int add(int a, int b) throws android.os.RemoteException;

    public String getMessage() throws android.os.RemoteException;



    abstract class Stub extends android.os.Binder implements IMyAidlInterface {

        ...

    }

}

ğŸ”¹ 3. åœ¨ Service ä¸­å®ç°æ¥å£

public class MyAidlService extends Service {

    private final IMyAidlInterface.Stub mBinder = new IMyAidlInterface.Stub() {

        @Override

        public int add(int a, int b) {

            return a + b;

        }



        @Override

        public String getMessage() {

            return "Hello from AIDL Service!";

        }

    };



    @Override

    public IBinder onBind(Intent intent) {

        return mBinder;

    }

}

åœ¨ AndroidManifest.xml ä¸­å£°æ˜ï¼š

\<service

    android:name=".MyAidlService"

    android:process=":remote"  <!-- è¿è¡Œåœ¨ç‹¬ç«‹è¿›ç¨‹ -->

    android:exported="true">

    <intent-filter>

        <action android:name="com.example.aidl.MyAidlService" />

    </intent-filter>

`</service>`{=html}

ğŸ”¹ 4. å®¢æˆ·ç«¯ç»‘å®šå¹¶è°ƒç”¨

public class MainActivity extends AppCompatActivity {

    private IMyAidlInterface aidlService;



    private ServiceConnection connection = new ServiceConnection() {

        @Override

        public void onServiceConnected(ComponentName name, IBinder service) {

            aidlService = IMyAidlInterface.Stub.asInterface(service);

            try {

                int result = aidlService.add(3, 5);

                Log.d("AIDL", "Result: " + result);

            } catch (RemoteException e) {

                e.printStackTrace();

            }

        }



        @Override

        public void onServiceDisconnected(ComponentName name) {

            aidlService = null;

        }

    };



    @Override

    protected void onStart() {

        super.onStart();

        Intent intent = new Intent("com.example.aidl.MyAidlService");

        intent.setPackage("com.example.aidl"); // æ˜ç¡®åŒ…å

        bindService(intent, connection, BIND_AUTO_CREATE);

    }

}

ä¸ƒã€ä½¿ç”¨ AIDL çš„æ³¨æ„äº‹é¡¹

1,çº¿ç¨‹é—®é¢˜ï¼šAIDL æ–¹æ³•é»˜è®¤è¿è¡Œåœ¨ Binder çº¿ç¨‹æ± ä¸­ï¼Œä¸èƒ½ç›´æ¥æ›´æ–° UIã€‚

2,æ•°æ®å¤§å°ï¼šè·¨è¿›ç¨‹é€šä¿¡æ—¶æ•°æ®ä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™ä¼šæŠ›
TransactionTooLargeExceptionã€‚

2,å®‰å…¨æ€§ï¼šå¦‚æœ Service
android:exported="true"ï¼Œè¦é˜²æ­¢æ¶æ„åº”ç”¨è°ƒç”¨ï¼ˆå¯ä»¥éªŒè¯åŒ…åæˆ–ç­¾åï¼‰ã€‚

æ¥å£ç‰ˆæœ¬å…¼å®¹ï¼šAIDL æ¥å£å˜æ›´éœ€æ³¨æ„ç‰ˆæœ¬å…¼å®¹é—®é¢˜ã€‚

éå¸¸å¥½çš„é—®é¢˜ ğŸ‘ ä½ é—®åˆ°äº† AIDL å®é™…å¼€å‘ä¸­æœ€å…³é”®çš„ç‚¹ä¹‹ä¸€ ------
å®‰å…¨æ€§éªŒè¯ã€‚

å½“ä½ æŠŠä¸€ä¸ª AIDL Service æš´éœ²å‡ºå»ï¼ˆandroid:exported="true"ï¼‰ï¼Œå°±æ„å‘³ç€ï¼š

ä»»ä½•å®‰è£…åœ¨åŒä¸€å°è®¾å¤‡ä¸Šçš„å…¶ä»– App éƒ½å¯èƒ½è°ƒç”¨å®ƒã€‚

å¦‚æœä¸åšå®‰å…¨æ ¡éªŒï¼Œæ¶æ„ App å¯ä»¥ï¼š

è°ƒç”¨ä½ çš„æ¥å£ï¼Œ

ä¼ å…¥éæ³•å‚æ•°ï¼Œ

å ç”¨ä½ çš„åå°æœåŠ¡èµ„æºï¼Œ

ç”šè‡³ç¯¡æ”¹æˆ–çªƒå–æ•°æ®ã€‚

ä¸‹é¢æˆ‘ç»™ä½ è®²è®² AIDL å®‰å…¨é˜²æŠ¤çš„ 3 ç§å¸¸è§æ–¹å¼ï¼ˆæŒ‰å®‰å…¨çº§åˆ«ä»ä½åˆ°é«˜ï¼‰ğŸ‘‡

âœ… æ–¹å¼ä¸€ï¼šé€šè¿‡åŒ…åéªŒè¯è°ƒç”¨æ¥æº

è¿™æ˜¯æœ€å¸¸è§ã€ç®€å•çš„ä¸€ç§æ–¹æ³•ã€‚ åœ¨ onBind() æˆ– onTransact()
é‡Œï¼Œæ£€æŸ¥æ˜¯è°åœ¨ç»‘å®šä½ çš„ Serviceã€‚

@Override

public IBinder onBind(Intent intent) {

    String callerPackage = getCallingPackageName();

    if (!"com.trusted.client".equals(callerPackage)) {

        Log.w("AIDL", "Unauthorized access from: " + callerPackage);

        return null; // æ‹’ç»ç»‘å®š

    }

    return mBinder;

}

/\*\* è·å–è°ƒç”¨æ–¹åŒ…å \*/

private String getCallingPackageName() {

    int callingUid = Binder.getCallingUid();

    String[] packages = getPackageManager().getPackagesForUid(callingUid);

    return (packages != null && packages.length > 0) ? packages[0] : null;

}

ğŸ§  åŸç†ï¼š

Binder.getCallingUid() è·å–è°ƒç”¨æ–¹çš„ UIDï¼›

å†é€šè¿‡ PackageManager.getPackagesForUid() æŸ¥å‡ºå¯¹åº”åŒ…åï¼›

å’Œä½ ä¿¡ä»»çš„åŒ…åæ¯”å¯¹ã€‚

âœ… æ–¹å¼äºŒï¼šé€šè¿‡ç­¾åéªŒè¯ï¼ˆæ›´å®‰å…¨ï¼‰

æ¶æ„åº”ç”¨å¯èƒ½ä¼ªé€ åŒ…åï¼ˆåªè¦åŒåå®‰è£…ï¼‰ï¼Œ æ‰€ä»¥æ›´å®‰å…¨çš„æ–¹å¼æ˜¯æ ¡éªŒ æ•°å­—ç­¾åã€‚

private boolean checkSignature() {

    int callingUid = Binder.getCallingUid();

    PackageManager pm = getPackageManager();

    String[] packages = pm.getPackagesForUid(callingUid);

    if (packages != null) {

        for (String pkg : packages) {

            try {

                PackageInfo info = pm.getPackageInfo(pkg, PackageManager.GET_SIGNING_CERTIFICATES);

                Signature[] signatures = info.signingInfo.getApkContentsSigners();



                // è·å–æœ¬åº”ç”¨ç­¾å

                PackageInfo myInfo = pm.getPackageInfo(getPackageName(), PackageManager.GET_SIGNING_CERTIFICATES);

                Signature[] mySignatures = myInfo.signingInfo.getApkContentsSigners();



                // æ¯”è¾ƒç­¾åæ˜¯å¦ä¸€è‡´

                if (signatures[0].equals(mySignatures[0])) {

                    return true; // ç­¾åç›¸åŒï¼Œå…è®¸è®¿é—®

                }



            } catch (Exception e) {

                e.printStackTrace();

            }

        }

    }

    return false; // ç­¾åä¸åŒ¹é…

}

@Override

public IBinder onBind(Intent intent) {

    if (!checkSignature()) {

        Log.w("AIDL", "Unauthorized signature detected!");

        return null;

    }

    return mBinder;

}

ğŸ”’ å¥½å¤„ï¼š

å³ä½¿åŒ…åè¢«ä¼ªé€ ï¼Œåªè¦ç­¾åä¸ä¸€æ ·ï¼Œä»ç„¶æ— æ³•è®¿é—®ï¼›

è¿™ç§æ–¹å¼æœ€å¸¸ç”¨äºè‡ªå®¶ App æ¨¡å—é—´é€šä¿¡ï¼ˆä¾‹å¦‚ä¸» App è°ƒæ’ä»¶ Appï¼‰ã€‚

âœ… æ–¹å¼ä¸‰ï¼šä½¿ç”¨æƒé™ï¼ˆPermissionï¼‰æ§åˆ¶

åœ¨ AndroidManifest.xml ä¸­å£°æ˜ä¸€ä¸ªè‡ªå®šä¹‰æƒé™ï¼š

`<permission

    android:name="com.example.myapp.PERMISSION_ACCESS_AIDL"

    android:protectionLevel="signature" />`{=html}

åœ¨ä½ çš„ Service ä¸­ä½¿ç”¨è¿™ä¸ªæƒé™ï¼š

`<service

    android:name=".MyAidlService"

    android:permission="com.example.myapp.PERMISSION_ACCESS_AIDL"

    android:exported="true">`{=html}

    <intent-filter>

        <action android:name="com.example.aidl.MyAidlService" />

`</intent-filter>`{=html}

`</service>`{=html}

âœ… åŸç†ï¼š

åªæœ‰ç­¾åç›¸åŒã€ä¸”æ˜¾å¼å£°æ˜ä½¿ç”¨äº†æ­¤æƒé™çš„ App æ‰èƒ½è®¿é—®ï¼›

è¿™ç§æ–¹å¼ç³»ç»Ÿçº§åˆ«æ§åˆ¶ï¼Œæœ€å®‰å…¨ä¹Ÿæœ€æ–¹ä¾¿ï¼›

æ— éœ€å†™ä»£ç éªŒè¯ï¼ŒAndroid æ¡†æ¶å±‚ä¼šè‡ªåŠ¨æ‹¦æˆªéæ³•è°ƒç”¨ã€‚

Viewçš„ç»˜åˆ¶æµç¨‹

è¿™ä¸ªé—®é¢˜å¾ˆå…³é”®ï¼ŒAndroid View ç»˜åˆ¶æ ¸å¿ƒæµç¨‹æ˜¯æµ‹é‡ï¼ˆMeasureï¼‰â†’
å¸ƒå±€ï¼ˆLayoutï¼‰â†’ ç»˜åˆ¶ï¼ˆDrawï¼‰ä¸‰æ­¥ï¼Œä»é¡¶å±‚ View é€’å½’æ‰§è¡Œåˆ°æ‰€æœ‰å­ Viewã€‚

\### 1. æµ‹é‡ï¼ˆMeasureï¼‰ï¼šç¡®å®š View å¤§å° - çˆ¶ View
ä¼ é€’æµ‹é‡è§„æ ¼ï¼ˆMeasureSpecï¼‰ï¼ŒåŒ…å«æ¨¡å¼ï¼ˆEXACTLY/AT_MOST/UNSPECIFIEDï¼‰å’Œå»ºè®®å°ºå¯¸ã€‚ -
View ç»“åˆè‡ªèº«
LayoutParamsï¼Œé€šè¿‡onMeasure()è®¡ç®—å‡ºæœ€ç»ˆå®½é«˜ï¼ˆsetMeasuredDimension()
ç¡®å®šï¼‰ã€‚ - å®¹å™¨ç±» Viewï¼ˆå¦‚ LinearLayoutï¼‰ä¼šéå†å­ View è°ƒç”¨
measure()ï¼Œå®Œæˆæ‰€æœ‰å­ View æµ‹é‡ã€‚

--- \### 2. å¸ƒå±€ï¼ˆLayoutï¼‰ï¼šç¡®å®š View ä½ç½® - çˆ¶ View æ‹¿åˆ°å­ View
æµ‹é‡åçš„å°ºå¯¸ï¼Œé€šè¿‡onLayout()ç¡®å®šå­ View
åœ¨è‡ªèº«åæ ‡ç³»ä¸­çš„ä½ç½®ï¼ˆleft/top/right/bottomï¼‰ã€‚ - å­ View æ¥æ”¶çˆ¶ View
ä¼ é€’çš„ä½ç½®å‚æ•°ï¼Œè°ƒç”¨è‡ªèº« layout() æ–¹æ³•ï¼Œè¿›ä¸€æ­¥é€’å½’å¸ƒå±€å­ Viewã€‚ -
æ­¤é˜¶æ®µä»…ç¡®å®šä½ç½®ï¼Œä¸æ”¹å˜å·²æµ‹é‡çš„å°ºå¯¸ã€‚

--- \### 3. ç»˜åˆ¶ï¼ˆDrawï¼‰ï¼šå°† View æ¸²æŸ“åˆ°å±å¹• -
æ ¸å¿ƒé€šè¿‡onDraw(Canvas)å®ç°ï¼ŒCanvas æä¾›ç»˜åˆ¶å›¾å½¢ã€æ–‡å­—ã€å›¾ç‰‡çš„ APIã€‚ -
ç»˜åˆ¶é¡ºåºï¼šå…ˆç»˜åˆ¶èƒŒæ™¯ï¼ˆdrawBackground()ï¼‰ï¼Œå†ç»˜åˆ¶è‡ªèº«å†…å®¹ï¼ˆonDraw()ï¼‰ï¼Œæœ€åç»˜åˆ¶å­
Viewï¼ˆdispatchDraw()ï¼‰å’Œè£…é¥°ï¼ˆå¦‚æ»šåŠ¨æ¡ï¼‰ã€‚ - ä»…å½“ View å¯è§ã€å°ºå¯¸ä¸ä¸º 0
æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œç»˜åˆ¶ã€‚ --- è¦ä¸è¦æˆ‘å¸®ä½ æ•´ç†ä¸€ä»½View
ç»˜åˆ¶æµç¨‹æ ¸å¿ƒæ–¹æ³•è°ƒç”¨é“¾è·¯+å¸¸è§é—®é¢˜æ’æŸ¥æ¸…å•ï¼ŸåŒ…å« onMeasure
é‡å†™ç¤ºä¾‹ã€MeasureSpec è§£æï¼Œæ–¹ä¾¿ä½ å®é™…å¼€å‘ä¸­å‚è€ƒã€‚

ç®€è¿°androidäº‹ä»¶åˆ†å‘æœºåˆ¶Â 

dispatchTouchEvent onTouchEvent onInterceptTouchEvent

çº¿ç¨‹

å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä»½å…±äº«èµ„æºçš„æ—¶å€™ï¼ŒåŠ é”æ¥è®©çº¿ç¨‹æ’é˜Ÿæ‰§è¡Œ ï¼Œ

æ­»é”

å¦‚æœçº¿ç¨‹AæŒæœ‰é”Lå¹¶ä¸”æƒ³è·å¾—é”Mï¼Œçº¿ç¨‹BæŒæœ‰é”Må¹¶ä¸”æƒ³è·å¾—é”Lï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªçº¿ç¨‹å°†
æ°¸è¿œç­‰å¾…ä¸‹å»ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯æœ€ç®€å•çš„æ­»é”å½¢å¼ã€‚

é¿å…ï¼š

è®¾è®¡æ—¶è€ƒè™‘æ¸…æ¥šé”çš„é¡ºåºï¼Œå°½é‡å‡å°‘åµŒåœ¨çš„åŠ é”äº¤äº’æ•°é‡

æ—¢ç„¶æ­»é”çš„äº§ç”Ÿæ˜¯ä¸¤ä¸ªçº¿ç¨‹æ— é™ç­‰å¾…å¯¹æ–¹æŒæœ‰çš„é”ï¼Œé‚£ä¹ˆåªè¦ç­‰å¾…æ—¶é—´æœ‰ä¸ªä¸Šé™ä¸å°±å¥½äº†Lockç±»ä¸­çš„tryLockæ–¹æ³•å»å°è¯•è·å–é”ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥æŒ‡å®šä¸€ä¸ªè¶…æ—¶æ—¶é™ï¼Œåœ¨ç­‰å¾…è¶…è¿‡è¯¥æ—¶é™ä¹‹åå˜å›è¿”å›ä¸€ä¸ªå¤±è´¥ä¿¡æ¯ã€‚

çº¿ç¨‹æ± çš„å¤§è‡´åŸç†

    https://www.cnblogs.com/dolphin0520/p/3932921.html

    https://www.cnblogs.com/dongguacai/p/6030187.html

    å¦‚æœå¹¶å‘çš„çº¿ç¨‹æ•°é‡å¤šï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ—¶é—´å¾ˆçŸ­çš„ä»»åŠ¡å°±ç»“æŸäº†ï¼Œè¿™æ ·   é¢‘ç¹åˆ›å»ºçº¿ç¨‹å°±ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå› ä¸ºé¢‘ç¹åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹éœ€è¦æ—¶é—´ã€‚

    1. ThreadPoolExecutor ç»§æ‰¿AbstractExecutorService

corePoolSizeï¼šæ ¸å¿ƒæ± çš„å¤§å°

maximumPoolSizeï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œ

keepAliveTimeï¼šè¡¨ç¤ºçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶æœ€å¤šä¿æŒå¤šä¹…æ—¶é—´ä¼šç»ˆæ­¢ã€‚

unitï¼šå‚æ•°keepAliveTimeçš„æ—¶é—´å•ä½

workQueueï¼šä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™ä¸ªå‚æ•°çš„é€‰æ‹©ä¹Ÿå¾ˆé‡è¦ï¼Œä¼šå¯¹çº¿ç¨‹æ± çš„è¿è¡Œè¿‡ç¨‹äº§ç”Ÿé‡å¤§å½±å“

threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œä¸»è¦ç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼›

handlerï¼šè¡¨ç¤ºå½“æ‹’ç»å¤„ç†ä»»åŠ¡æ—¶çš„ç­–ç•¥ï¼Œ

2 çº¿ç¨‹æ± åŸç†

1ã€åˆ¤æ–­çº¿ç¨‹æ± é‡Œçš„æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä¸æ˜¯ï¼ˆæ ¸å¿ƒçº¿ç¨‹ç©ºé—²æˆ–è€…è¿˜æœ‰æ ¸å¿ƒçº¿ç¨‹æ²¡æœ‰è¢«åˆ›å»ºï¼‰åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœæ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™è¿›å…¥ä¸‹ä¸ªæµç¨‹ã€‚

2ã€çº¿ç¨‹æ± åˆ¤æ–­å·¥ä½œé˜Ÿåˆ—æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœå·¥ä½œé˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œåˆ™å°†æ–°æäº¤çš„ä»»åŠ¡å­˜å‚¨åœ¨è¿™ä¸ªå·¥ä½œé˜Ÿåˆ—é‡Œã€‚å¦‚æœå·¥ä½œé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™è¿›å…¥ä¸‹ä¸ªæµç¨‹ã€‚

3ã€åˆ¤æ–­çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ˜¯å¦éƒ½å¤„äºå·¥ä½œçŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœå·²ç»æ»¡äº†ï¼Œåˆ™äº¤ç»™é¥±å’Œç­–ç•¥æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚

15.çº¿ç¨‹çš„ä¿æ´»

é»‘è‰²ä¿æ´»ï¼šä¸åŒçš„appè¿›ç¨‹ï¼Œç”¨å¹¿æ’­ç›¸äº’å”¤é†’ï¼ˆåŒ…æ‹¬åˆ©ç”¨ç³»ç»Ÿæä¾›çš„å¹¿æ’­è¿›è¡Œå”¤é†’ï¼‰

ç™½è‰²ä¿æ´»ï¼šå¯åŠ¨å‰å°Service

ç°è‰²ä¿æ´»ï¼šåˆ©ç”¨ç³»ç»Ÿçš„æ¼æ´å¯åŠ¨å‰å°Service

å›¾ç‰‡å‹ç¼©

è¡¥é—´åŠ¨ç”»

Xml

tween_image.startAnimation(anim); tween_image.startAnimation(anim);

ä»£ç 

Animation translateAnimation = new TranslateAnimation(0ï¼Œ500ï¼Œ0ï¼Œ500);

mButton.startAnimation(translateAnimation);

å±æ€§åŠ¨ç”»

ValueAnimator anim = ValueAnimator.ofInt(0, 3);é€šè¿‡ä¸æ–­æ§åˆ¶ å€¼
çš„å˜åŒ–ï¼Œå†ä¸æ–­ æ‰‹åŠ¨ èµ‹ç»™å¯¹è±¡çš„å±æ€§ï¼Œä»è€Œå®ç°åŠ¨ç”»æ•ˆæœã€‚

Animator animator = AnimatorInflater.loadAnimator(context,
R.animator.set_animation);

// è½½å…¥XMLåŠ¨ç”»

16. è¿›ç¨‹ä¼˜å…ˆçº§

å‰å°è¿›ç¨‹ å¯è§è¿›ç¨‹ æœåŠ¡è¿›ç¨‹ åå°è¿›ç¨‹ ç©ºè¿›ç¨‹

18 ï¼ŒHandlerçš„åŸç†

1ã€handlerå°è£…æ¶ˆæ¯çš„å‘é€ï¼ˆä¸»è¦åŒ…æ‹¬æ¶ˆæ¯å‘é€ç»™è°ï¼‰

Â  Â  Â  2ã€Looper------æ¶ˆæ¯å°è£…çš„è½½ä½“ã€‚

ï¼ˆ1ï¼‰å†…éƒ¨åŒ…å«ä¸€ä¸ªMessageQueueï¼Œæ‰€æœ‰çš„Handlerå‘é€çš„æ¶ˆæ¯éƒ½èµ°å‘è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼›

ï¼ˆ2ï¼‰Looper.Looperæ–¹æ³•ï¼Œå°±æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¸æ–­åœ°ä»MessageQueueå–æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ¶ˆæ¯å°±å¤„ç†æ¶ˆæ¯ï¼Œæ²¡
æœ‰æ¶ˆ æ¯å°±é˜»å¡ã€‚

Â  Â  Â  3ã€MessageQueueï¼Œä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ·»åŠ æ¶ˆæ¯ï¼Œå¤„ç†æ¶ˆæ¯

Â  Â  Â 
4ã€handlerå†…éƒ¨ä¸Looperå…³è”ï¼Œhandler-\>Looper-\>MessageQueue,handlerå‘é€æ¶ˆæ¯å°±
æ˜¯å‘MessageQueueé˜Ÿ åˆ—å‘é€æ¶ˆæ¯ã€‚

Â  Â 
Â æ€»ç»“ï¼šhandlerè´Ÿè´£å‘é€æ¶ˆæ¯ï¼ŒLooperè´Ÿè´£æ¥æ”¶handlerå‘é€çš„æ¶ˆæ¯ï¼Œå¹¶æŠŠæ¶ˆæ¯å›ä¼ ç»™handlerè‡ªå·±ã€‚

ç½‘ç»œç›¸å…³é¢è¯•é¢˜

å¯ä»¥ä»ä¸­å¯¹æ¯”GETæ–¹æ³•å’ŒPOSTæ–¹æ³•çš„åŒºåˆ«ï¼š

ã€€ã€€GETæ–¹æ³•éœ€è¦ç”¨ï¼Ÿå°†å‚æ•°è¿æ¥åœ¨URLåé¢ï¼Œå„ä¸ªå‚æ•°ä¹‹é—´ç”¨&è¿æ¥ã€‚

POSTæ–¹æ³•å‘é€è¯·æ±‚æ—¶ï¼Œä»ç„¶ä½¿ç”¨åŸºæœ¬çš„URLï¼Œå°†å‚æ•°ä¿¡æ¯æ”¾åœ¨è¯·æ±‚å®ä½“ä¸­å‘é€ã€‚

ç½‘ç»œåè®®

TCPå»ºç«‹è¿æ¥

åºåˆ—å· Sequeuece number(seq): æ•°æ®åŒ…æœ¬èº«çš„åºåˆ—å·ï¼Œåˆå§‹åºåˆ—å·æ˜¯éšæœºçš„ã€‚

ç¡®è®¤å· Acknowledgment number(ack): åœ¨æ¥æ”¶ç«¯ï¼Œç”¨æ¥é€šçŸ¥å‘é€ç«¯æ•°æ®æˆåŠŸæ¥æ”¶

æ ‡å¿—ä½ï¼Œæ ‡å¿—ä½åªæœ‰ä¸º 1 çš„æ—¶å€™æ‰æœ‰æ•ˆ

SYNï¼ˆsynchronizeï¼‰ï¼šè¡¨ç¤ºåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚

ACKï¼šTCPåè®®è§„å®šï¼Œåªæœ‰ACK=1æ—¶æœ‰æ•ˆï¼Œä¹Ÿè§„å®šè¿æ¥å»ºç«‹åæ‰€æœ‰å‘é€çš„æŠ¥æ–‡çš„ACKå¿…é¡»ä¸º1.

FINï¼ˆfinishï¼‰ï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ã€‚å½“FIN=1æ—¶ï¼Œè¡¨æ˜æ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿æ¥ã€‚

ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æŠ¥æ–‡ï¼›å³SYN=1ï¼ŒACK=0ï¼Œseq=xã€‚

ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚æŠ¥æ–‡ï¼ŒæœåŠ¡ç«¯ä¼šç¡®è®¤åº”ç­”ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å·²ç»æ”¶åˆ°è¯·æ±‚äº†ï¼›å³SYN=1ï¼ŒACK=1,seq=yï¼Œack=x+1ï¼›

ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ç¡®è®¤åº”ç­”åï¼Œå†æ¬¡å‘æœåŠ¡ç«¯è¿›è¡Œç¡®è®¤åº”ç­”ï¼Œå»ºç«‹å®Œæ•´çš„è¿æ¥ï¼›å³ACK=1ï¼Œseq=x+1ï¼Œack=y+1

ç®€è¿° ï¼šå®¢å‘æœå‘é€æŠ¥æ–‡ ï¼Œ 2 æœæ”¶åˆ°å ï¼Œåº”ç­” å‘Šè¯‰å®¢ æˆ‘æ”¶åˆ°äº†
3ï¼Œæ”¶åˆ°åå†æ¬¡ç¡®è®¤åº”ç­” å®Œæˆ

éå¸¸æ£’ ğŸ‘ï¼Œä½ è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ° ç½‘ç»œé€šä¿¡çš„æ ¸å¿ƒåŸºç¡€ï¼Œ æ— è®ºæ˜¯
Androidã€åç«¯ã€ç‰©è”ç½‘ã€è½¦è½½ã€è¿˜æ˜¯æ¸¸æˆå¼€å‘ï¼Œè¿™å—éƒ½æ˜¯å…³é”®çŸ¥è¯†ã€‚

æˆ‘ä»¬æ¥ç³»ç»Ÿè®²ä¸€ä¸‹ ------ HTTPã€TCP/IPã€UDPã€TCPã€UDP+TCP ç»“åˆã€Socket
çš„åŒºåˆ«ä¸å…³ç³» æˆ‘ä¼šå¸®ä½ æ¢³ç†å‡ºé€»è¾‘å…³ç³» + åº”ç”¨åœºæ™¯ + å®é™…ä½¿ç”¨ç¤ºä¾‹

ä¸€ã€ä»æ•´ä½“çœ‹ç½‘ç»œé€šä¿¡ç»“æ„

ç½‘ç»œé€šä¿¡æ˜¯åˆ†å±‚çš„ï¼ŒTCP/IP æ¨¡å‹ æ˜¯äº’è”ç½‘çš„åŸºç¡€ã€‚

ğŸ‘‰ æ‰€ä»¥ï¼š

HTTP æ˜¯ åº”ç”¨å±‚åè®®ï¼Œ TCP/UDP æ˜¯ ä¼ è¾“å±‚åè®®ï¼Œ IP æ˜¯ ç½‘ç»œå±‚åè®®ã€‚

äºŒã€HTTP æ˜¯ä»€ä¹ˆï¼Ÿ

HTTPï¼ˆHyperText Transfer Protocolï¼‰ æ˜¯å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Š çš„
åº”ç”¨å±‚åè®®ã€‚

ç‰¹ç‚¹ï¼š

åŸºäº è¯·æ±‚/å“åº”æ¨¡å‹

å¯é ä¼ è¾“ï¼ˆå› ä¸ºåº•å±‚æ˜¯ TCPï¼‰

ä¸€èˆ¬ç”¨äºç½‘é¡µã€æ¥å£ã€æ–‡ä»¶ä¼ è¾“

æµç¨‹ï¼š

æµè§ˆå™¨(å®¢æˆ·ç«¯)

â†“ TCPä¸‰æ¬¡æ¡æ‰‹

æœåŠ¡å™¨

â†“ å‘é€HTTPè¯·æ±‚(Request)

â†‘ è¿”å›HTTPå“åº”(Response)

â†“ TCPå››æ¬¡æŒ¥æ‰‹å…³é—­

å¸¸ç”¨è¯·æ±‚ç¤ºä¾‹ï¼š

GET /user?id=100 HTTP/1.1

Host: example.com

å“åº”ï¼š

HTTP/1.1 200 OK

Content-Type: application/json

{"name":"Tom","age":25}

HTTP ä¸ HTTPS çš„åŒºåˆ«

HTTPS = HTTP + SSL/TLS + TCP

ä¸‰ã€TCP åè®®è¯¦è§£ï¼ˆå¯é ä¼ è¾“ï¼‰

TCPï¼ˆTransmission Control Protocolï¼‰ æ˜¯ä¸€ç§ é¢å‘è¿æ¥ã€å¯é ã€æœ‰åº
çš„ä¼ è¾“åè®®ã€‚

âœ… ç‰¹ç‚¹

éœ€è¦ ä¸‰æ¬¡æ¡æ‰‹ å»ºç«‹è¿æ¥

æœ‰åºä¼ è¾“ï¼ˆåºåˆ—å·ï¼‰

å¯é é‡ä¼ ï¼ˆACK ç¡®è®¤ï¼‰

æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶

ğŸ”„ ä¸‰æ¬¡æ¡æ‰‹ï¼ˆå»ºç«‹è¿æ¥ï¼‰

Client ---\> SYN=1 ---\> Server

Client \<--- SYN=1, ACK=1 \<--- Server

Client ---\> ACK=1 ---\> Server

å»ºç«‹åŒå‘è¿æ¥é€šé“ã€‚

ğŸ”š å››æ¬¡æŒ¥æ‰‹ï¼ˆæ–­å¼€è¿æ¥ï¼‰

Client ---\> FIN=1 ---\> Server

Client \<--- ACK=1 \<--- Server

Client \<--- FIN=1 \<--- Server

Client ---\> ACK=1 ---\> Server

ç¡®ä¿åŒæ–¹éƒ½å®Œæˆæ•°æ®å‘é€åæ–­å¼€ã€‚

ğŸ’¡ åº”ç”¨åœºæ™¯ï¼š

HTTP / HTTPSï¼ˆç½‘é¡µè¯·æ±‚ï¼‰

æ–‡ä»¶ä¼ è¾“ï¼ˆFTPï¼‰

é‚®ä»¶ï¼ˆSMTPï¼‰

èŠå¤©ï¼ˆå¾®ä¿¡ã€QQ ç­‰ï¼‰

âš¡ å››ã€UDP åè®®è¯¦è§£ï¼ˆå¿«é€Ÿä¼ è¾“ï¼‰

UDPï¼ˆUser Datagram Protocolï¼‰ æ˜¯ä¸€ç§ æ— è¿æ¥ã€ä¸å¯é  çš„ä¼ è¾“åè®®ã€‚

âœ… ç‰¹ç‚¹

æ— è¿æ¥ï¼ˆä¸æ¡æ‰‹ï¼‰

ä¸ä¿è¯é¡ºåºã€ä¸ä¿è¯å¯é 

ä¼ è¾“é€Ÿåº¦å¿«ã€å»¶è¿Ÿä½

é€‚åˆå®æ—¶æ€§å¼ºåœºæ™¯

ğŸ’¡ åº”ç”¨åœºæ™¯ï¼š

å®æ—¶éŸ³è§†é¢‘ï¼ˆWebRTCã€VoIPï¼‰

æ¸¸æˆåŒæ­¥

ç›´æ’­

å±€åŸŸç½‘å¹¿æ’­

ğŸ§© å¯¹æ¯”ï¼šTCP vs UDP

ğŸ”„ äº”ã€TCP + UDP ç»“åˆä½¿ç”¨

å®é™…é¡¹ç›®ä¸­ç»å¸¸"æ··åˆä½¿ç”¨"ğŸ‘‡

ğŸ§± å…­ã€Socket ç¼–ç¨‹ï¼ˆæ ¸å¿ƒæ¦‚å¿µï¼‰

Socket æ˜¯ å¯¹ TCP/UDP çš„ç¼–ç¨‹å°è£…ã€‚ å®ƒæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„"ç½‘ç»œé€šä¿¡æ¥å£"ã€‚

â‘  TCP Socket é€šä¿¡ç¤ºä¾‹

æœåŠ¡å™¨ç«¯

ServerSocket serverSocket = new ServerSocket(8080);

Socket socket = serverSocket.accept(); // ç­‰å¾…è¿æ¥

InputStream input = socket.getInputStream();

OutputStream output = socket.getOutputStream();

BufferedReader reader = new BufferedReader(new
InputStreamReader(input));

String msg = reader.readLine();

System.out.println("Client:" + msg);

output.write("Hello Client`\n`{=tex}".getBytes());

socket.close();

serverSocket.close();

å®¢æˆ·ç«¯

Socket socket = new Socket("127.0.0.1", 8080);

OutputStream output = socket.getOutputStream();

output.write("Hello Server`\n`{=tex}".getBytes());

BufferedReader reader = new BufferedReader(new
InputStreamReader(socket.getInputStream()));

System.out.println("Server:" + reader.readLine());

socket.close();

âœ… è¿™æ˜¯ åŸºäº TCP çš„å¯é é€šä¿¡ã€‚

â‘¡ UDP Socket é€šä¿¡ç¤ºä¾‹

å‘é€ç«¯

DatagramSocket socket = new DatagramSocket();

byte\[\] data = "Hello UDP".getBytes();

DatagramPacket packet = new DatagramPacket(data, data.length,
InetAddress.getByName("127.0.0.1"), 8080);

socket.send(packet);

socket.close();

æ¥æ”¶ç«¯

DatagramSocket socket = new DatagramSocket(8080);

byte\[\] buffer = new byte\[1024\];

DatagramPacket packet = new DatagramPacket(buffer, buffer.length);

socket.receive(packet);

System.out.println("Received:" + new String(packet.getData(), 0,
packet.getLength()));

socket.close();

âœ… è¿™æ˜¯ æ— è¿æ¥çš„å¿«é€Ÿé€šä¿¡ã€‚

ä¸ƒã€Socket åœ¨ Android ä¸­çš„ä½¿ç”¨

å¸¸è§åº”ç”¨åœºæ™¯ï¼š

å®æ—¶èŠå¤©ï¼ˆTCP é•¿è¿æ¥ï¼‰

å±€åŸŸç½‘é€šä¿¡ï¼ˆUDP å¹¿æ’­ï¼‰

IoT è®¾å¤‡æ§åˆ¶ï¼ˆUDP + TCPï¼‰

WebSocketï¼ˆåŸºäº TCP çš„åŒå‘é€šä¿¡ï¼‰

Android ä¾‹å­ï¼ˆç®€å•èŠå¤©ï¼‰

Thread {

    val socket = Socket("192.168.1.10", 8080)

    val out = PrintWriter(socket.getOutputStream(), true)

    val input = BufferedReader(InputStreamReader(socket.getInputStream()))



    out.println("Hello Server")

    val msg = input.readLine()

    Log.d("Socket", "Server says: $msg")

    socket.close()

}.start()

âš ï¸ æ³¨æ„ï¼šä¸èƒ½åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨ç½‘ç»œï¼ˆä¼šæŠ› NetworkOnMainThreadExceptionï¼‰
å»ºè®®ä½¿ç”¨åç¨‹ã€HandlerThreadã€æˆ– WorkManagerã€‚

å…«ã€æ€»ç»“æ€ç»´å¯¼å›¾

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

        â”‚        åº”ç”¨å±‚          â”‚

        â”‚   HTTP / MQTT / FTP    â”‚

        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                  â”‚ åŸºäº

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

        â”‚       ä¼ è¾“å±‚            â”‚

        â”‚  TCP (å¯é ) / UDP (å¿«)  â”‚

        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                  â”‚ ä¾èµ–

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”

        â”‚       ç½‘ç»œå±‚ (IP)       â”‚

        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ ç”»ä¸€ä¸ª ğŸ‘‰ TCPã€UDPã€HTTPã€Socket
çš„äº¤äº’æ—¶åºå›¾ï¼ˆå¸¦è¿æ¥ã€æ•°æ®ã€æ–­å¼€ï¼‰ï¼Ÿ
å¯è§†åŒ–ç†è§£æ›´ç›´è§‚ï¼Œç‰¹åˆ«é€‚åˆé¢è¯•æˆ–è®²è§£ç”¨ã€‚

å¯é  UDP æ¡†æ¶ä¸¾ä¾‹

å®é™…é¡¹ç›®ç­–ç•¥ï¼ˆç»¼åˆæ–¹æ¡ˆï¼‰

æ€»ç»“æ€ç»´å¯¼å›¾

UDP ä¸å¯é 

â”‚

â”œâ”€ ä¸¢åŒ… â†’ é‡ä¼ æœºåˆ¶ï¼ˆACK/è¶…æ—¶ï¼‰

â”œâ”€ ä¹±åº â†’ åºåˆ—å· + ç¼“å†²æ’åº

â”œâ”€ é‡å¤ â†’ å»é‡ï¼ˆseqï¼‰

â”œâ”€ æ— è¿æ¥ â†’ å¿ƒè·³æ£€æµ‹ + è¶…æ—¶é‡è¿

â”œâ”€ æ ¡éªŒé”™è¯¯ â†’ CRC æ ¡éªŒ

â””â”€ æå‡å¯é æ€§ â†’ KCP / QUIC / RTP

19ï¼ŒéUIçº¿ç¨‹çœŸçš„ä¸èƒ½æ›´æ–°UIå—ï¼Ÿ

ç­”ï¼šä¸ä¸€å®šï¼Œä¹‹æ‰€ä»¥å­çº¿ç¨‹ä¸èƒ½æ›´æ–°ç•Œé¢ï¼Œæ˜¯å› ä¸ºAndroidåœ¨çº¿ç¨‹çš„æ–¹æ³•é‡Œé¢é‡‡ç”¨checkThreadè¿›è¡Œåˆ¤æ–­æ˜¯å¦æ˜¯ä¸»çº¿ç¨‹ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ViewRootImplä¸­çš„ï¼Œè¿™ä¸ªç±»æ˜¯åœ¨onResumeé‡Œé¢æ‰ç”Ÿæˆçš„ï¼Œå› æ­¤ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™å­çº¿ç¨‹åœ¨onCreateæ–¹æ³•é‡Œé¢ç”Ÿæˆæ›´æ–°UIï¼Œè€Œä¸”æ²¡æœ‰åšé˜»å¡ï¼Œå°±æ˜¯è€—æ—¶å¤šçš„æ“ä½œï¼Œè¿˜æ˜¯å¯ä»¥æ›´æ–°UIçš„ã€‚

20ï¼ŒOOM

éå¸¸æ£’ ğŸ‘ï¼Œè¿™æ˜¯ Android æ€§èƒ½ä¼˜åŒ–ä¸­æœ€é‡è¦ã€æœ€å®¹æ˜“"å‘"çš„ä¸€éƒ¨åˆ†ã€‚

æˆ‘ä»¬æ¥ç³»ç»Ÿè®²è§£ï¼š ğŸ‘‰ å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰ ğŸ‘‰ å¸¸è§æ³„æ¼åœºæ™¯ä¸åŸå›  ğŸ‘‰
å¦‚ä½•æ£€æµ‹å’Œè§£å†³ï¼ˆLeakCanaryã€MATã€Profilerï¼‰ ğŸ‘‰ OOMï¼ˆOut Of
Memoryï¼‰åŸå› ä¸é˜²èŒƒç­–ç•¥

ğŸ§  ä¸€ã€ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰

ğŸ“Œ å®šä¹‰ï¼š

å¯¹è±¡åœ¨ä¸å†éœ€è¦ä½¿ç”¨æ—¶ï¼Œä»è¢«å…¶ä»–å¯¹è±¡æŒæœ‰å¼•ç”¨ï¼Œå¯¼è‡´ GC
æ— æ³•å›æ”¶ï¼Œå†…å­˜å ç”¨ä¸æ–­å¢é•¿ã€‚

ğŸ“Œ ä¸¾ä¾‹è¯´æ˜ï¼š

class A {

    static B b;

}

class B { ... }

// somewhere

A.b = new B(); // b æ˜¯é™æ€çš„

// å³ä½¿ä¸å†ç”¨ Bï¼ŒA.b ä¾ç„¶å¼•ç”¨ï¼Œæ— æ³•é‡Šæ”¾

ç»“æœï¼šB ä¸€ç›´è¢«æŒæœ‰ â†’ æ³„æ¼ã€‚

âš ï¸ äºŒã€å†…å­˜æ³„æ¼çš„å±å®³

ğŸ“¦ ä¸‰ã€å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯æ€»ç»“ï¼ˆAndroidé‡ç‚¹ï¼‰

âœ… 1ï¸âƒ£ é™æ€å˜é‡æŒæœ‰ Context / Activity

public class AppManager {

    public static Context context;

}

// é”™è¯¯å†™æ³•

AppManager.context = activity;

âŒ Activity ä¼šä¸€ç›´è¢«æŒæœ‰ï¼Œæ— æ³•é‡Šæ”¾ã€‚ âœ… è§£å†³ï¼š

AppManager.context = activity.getApplicationContext();

âœ… 2ï¸âƒ£ Handler å¯¼è‡´ Activity æ³„æ¼

public class MainActivity extends AppCompatActivity {

    private Handler handler = new Handler() {

        @Override

        public void handleMessage(Message msg) { }

    };

}

ğŸ”´ åŸå› ï¼šHandler æ˜¯éé™æ€å†…éƒ¨ç±»ï¼ŒæŒæœ‰å¤–éƒ¨ Activity å¼•ç”¨ã€‚ ğŸ”´
MessageQueue æœªå¤„ç†å®Œæ¶ˆæ¯æ—¶ï¼ŒActivity æ— æ³•å›æ”¶ã€‚

âœ… è§£å†³æ–¹å¼ä¸€ï¼šä½¿ç”¨é™æ€å†…éƒ¨ç±» + å¼±å¼•ç”¨

static class MyHandler extends Handler {

    private final WeakReference<MainActivity> ref;

    MyHandler(MainActivity activity) { ref = new WeakReference<>(activity); }



    @Override

    public void handleMessage(Message msg) {

        MainActivity act = ref.get();

        if (act != null) { /* update UI */ }

    }

}

âœ… æ–¹å¼äºŒï¼šonDestroy æ¸…é™¤æ¶ˆæ¯

@Override

protected void onDestroy() {

    handler.removeCallbacksAndMessages(null);

    super.onDestroy();

}

âœ… 3ï¸âƒ£ çº¿ç¨‹ / AsyncTask æœªåœæ­¢

new Thread(() -\> {

    // é•¿æ—¶é—´ä»»åŠ¡

}).start();

ğŸ”´ å¦‚æœ Activity é€€å‡ºäº†ï¼Œä½†çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œä¼šå¯¼è‡´ Activity è¢«å¼•ç”¨ã€‚ âœ…
è§£å†³ï¼š

ä½¿ç”¨ WeakReference å¼•ç”¨å¤–éƒ¨å¯¹è±¡

åœ¨ onDestroy() æ—¶ä¸­æ–­çº¿ç¨‹

ä½¿ç”¨ LifecycleScopeï¼ˆKotlin åç¨‹è‡ªåŠ¨æ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸï¼‰

âœ… 4ï¸âƒ£ éé™æ€å†…éƒ¨ç±»æ³„æ¼

public class Outer {

    class Inner { }

}

ğŸ”´ Inner æŒæœ‰ Outer çš„éšå¼å¼•ç”¨ã€‚ âœ… è§£å†³ï¼š

æ”¹ä¸º static class Inner

æˆ–è€…ä¸åœ¨ Activity ä¸­ç›´æ¥å®šä¹‰åŒ¿åå†…éƒ¨ç±»ï¼ˆListener/Callbackï¼‰

âœ… 5ï¸âƒ£ å•ä¾‹æŒæœ‰ Context / View

public class MyManager {

    private static MyManager instance;

    private Context context;



    public static MyManager getInstance(Context ctx) {

        if (instance == null) instance = new MyManager(ctx);

        return instance;

    }



    private MyManager(Context ctx) {

        this.context = ctx;

    }

}

ğŸ”´ é”™è¯¯ï¼šæŒæœ‰ Activity Context å¯¼è‡´æ— æ³•é‡Šæ”¾ã€‚ âœ… æ­£ç¡®ï¼š

this.context = ctx.getApplicationContext();

âœ… 6ï¸âƒ£ é›†åˆç¼“å­˜æœªæ¸…ç†ï¼ˆListã€Mapã€LruCacheï¼‰

static List`<Object>`{=html} cache = new ArrayList\<\>();

ğŸ”´ ç¼“å­˜å¼•ç”¨å¯¹è±¡ â†’ æ°¸ä¹…ä¸é‡Šæ”¾ã€‚ âœ… è§£å†³ï¼š

éœ€è¦æ—¶æ¸…ç† cache.clear()

æˆ–ä½¿ç”¨ WeakReference æˆ– SoftReference ç¼“å­˜

âœ… 7ï¸âƒ£ ç›‘å¬å™¨ / å¹¿æ’­ / æ³¨å†Œæœªå–æ¶ˆ

BroadcastReceiver

EventBus

ContentObserver

Listener

SensorManager

ğŸ”´ æ³¨å†Œåå¿˜è®° unregisterã€‚ âœ… è§£å†³ï¼š

@Override

protected void onDestroy() {

    unregisterReceiver(receiver);

    EventBus.getDefault().unregister(this);

}

âœ… 8ï¸âƒ£ WebView æ³„æ¼ï¼ˆæœ€å¸¸è§ï¼‰

ğŸ”´ åŸå› ï¼šWebView å†…éƒ¨çº¿ç¨‹ã€JS å¼•æ“æŒæœ‰ Activityã€‚ âœ… è§£å†³ï¼š

webView.loadUrl("about:blank");

webView.stopLoading();

webView.clearHistory();

webView.removeAllViews();

webView.destroy();

webView = null;

âœ… 9ï¸âƒ£ Bitmap æœªå›æ”¶

Bitmap bmp = BitmapFactory.decodeResource(getResources(),
R.drawable.big);

ğŸ”´ é•¿æ—¶é—´å ç”¨å¤§é‡å†…å­˜ã€‚ âœ… è§£å†³ï¼š

bmp.recycle();

bmp = null;

ï¼ˆAPI 26+ Bitmap æœ‰è‡ªåŠ¨å›æ”¶æœºåˆ¶ï¼‰

âœ… ğŸ”Ÿ RxJava æœªå–æ¶ˆè®¢é˜…

ğŸ”´ Observable ä»æŒæœ‰å¼•ç”¨ã€‚ âœ… è§£å†³ï¼š

Disposable disposable;

disposable.dispose(); // onDestroy é‡Œæ‰§è¡Œ

æˆ–ä½¿ç”¨ AutoDispose / LifecycleObserver

ğŸ’¥ å››ã€OOMï¼ˆOutOfMemoryErrorï¼‰

ğŸ“Œ å®šä¹‰ï¼š

å½“åº”ç”¨è¯·æ±‚å†…å­˜è¶…è¿‡ç³»ç»Ÿé™åˆ¶æ—¶ï¼Œå°±ä¼šæŠ›å‡º OOM å¼‚å¸¸ã€‚

ä¾‹å¦‚ï¼š

Caused by: java.lang.OutOfMemoryError: Failed to allocate a 16777216
byte allocation

ğŸ” å¸¸è§ OOM åŸå› 

âœ… OOM è§£å†³ç­–ç•¥

ğŸ”¬ äº”ã€å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·

LeakCanary ä½¿ç”¨ç¤ºä¾‹

debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.14'

è‡ªåŠ¨æ£€æµ‹æ³„æ¼ â†’ é€šçŸ¥æ æç¤ºï¼š

Activity com.xxx.MainActivity has leaked

ç‚¹å‡»å³å¯çœ‹åˆ°å¼•ç”¨é“¾ï¼ˆè°æŒæœ‰äº†å®ƒï¼‰ã€‚

ğŸ§© å…­ã€å¼€å‘ä¸­é˜²æ­¢å†…å­˜æ³„æ¼çš„é€šç”¨ç­–ç•¥

âœ… ä¸è¦è®© ç”Ÿå‘½å‘¨æœŸé•¿çš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¼•ç”¨ âœ… é™æ€å˜é‡ä¸è¦æŒæœ‰ Context
/ View âœ… Handlerã€Runnable ä½¿ç”¨é™æ€å†…éƒ¨ç±» + å¼±å¼•ç”¨ âœ…
åŠæ—¶æ³¨é”€æ³¨å†Œçš„ç›‘å¬å™¨ / å¹¿æ’­ âœ… ä½¿ç”¨ ApplicationContext æ›¿ä»£ Activity
Context âœ… ä½¿ç”¨ Profiler/LeakCanary ç›‘æ§å†…å­˜è¶‹åŠ¿ âœ… é¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤š
Bitmap / æ•°æ®

ğŸ’¡ ä¸ƒã€æ€»ç»“æ€ç»´å¯¼å›¾

å†…å­˜æ³„æ¼

â”‚

â”œâ”€ é™æ€å¼•ç”¨ Activity

â”œâ”€ Handler / Thread / AsyncTask

â”œâ”€ Listener æœªæ³¨é”€

â”œâ”€ WebView

â”œâ”€ Bitmap æœªå›æ”¶

â”œâ”€ RxJava æœªå–æ¶ˆ

â””â”€ é›†åˆç¼“å­˜æœªæ¸…ç†

    â†“

é€ æˆ OOM

â”‚

â”œâ”€ å›¾ç‰‡è¿‡å¤§

â”œâ”€ å¯¹è±¡æœªé‡Šæ”¾

â”œâ”€ é¢‘ç¹åˆ›å»ºå¯¹è±¡

â””â”€ å¤šçº¿ç¨‹ / JNI æŒæœ‰å¼•ç”¨

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ åšä¸€ä»½ ğŸ‘‰ ã€ŠAndroid å†…å­˜æ³„æ¼å®æˆ˜æ’æŸ¥æŒ‡å—ã€‹ï¼ˆå« LeakCanary
ä½¿ç”¨æ­¥éª¤ + OOM å®šä½æµç¨‹ + å¸¸è§æ—¥å¿—è§£æï¼‰ï¼Ÿ å¯ç›´æ¥ç”¨äºä½ é¡¹ç›®ä¸­æ’æŸ¥é—®é¢˜ã€‚

22ï¼ŒANR

å‡ºç°ANRä¸»è¦æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­åšäº†è€—æ—¶æ“ä½œ ï¼Œ åˆ†æ traces.txt

23 ,è‡ªå®šä¹‰Viewéœ€è¦æ³¨æ„çš„åœ°æ–¹

è®©Viewæ”¯æŒwrap_content

è®©Viewæ”¯æŒpadding

å°½é‡ä¸è¦åœ¨Viewä¸­ä½¿ç”¨Handler

Viewä¸­å¦‚æœæœ‰çº¿ç¨‹æˆ–è€…åŠ¨ç”»ï¼Œéœ€è¦åŠæ—¶åœæ­¢

Viewå¸¦æœ‰æ»‘åŠ¨åµŒå¥—æ—¶ï¼Œéœ€è¦å¤„ç†å¥½æ»‘åŠ¨å†²çªé—®é¢˜

åœ¨Viewçš„onDrawæ–¹æ³•ä¸­ä¸è¦åˆ›å»ºå¤ªå¤šçš„ä¸´æ—¶å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯newå‡ºæ¥çš„å¯¹è±¡ã€‚å› ä¸º
onDrawæ–¹æ³•ä¼šè¢«é¢‘ç¹è°ƒç”¨ï¼Œå¦‚æœæœ‰å¤§é‡çš„ä¸´æ—¶å¯¹è±¡ï¼Œå°±ä¼šå¼•èµ·å†…å­˜æŠ–åŠ¨ï¼Œå½±å“Viewçš„
æ•ˆæœ

ç¬¬ä¸‰æ–¹æ¡†æ¶ä½¿ç”¨ï¼š

Okhttp

ç”¨æ³•

OkHttpClient --\>Request --\>Call call = client.newCall(request);

        åŒæ­¥  -->Response response = call.execute()

        å¼‚æ­¥ -->call.enqueue(new Callback() 

Callå¯¹è±¡å¯¹äºè¯·æ±‚è¿›è¡Œå°è£…

Dispatcher å¯¹è¯·æ±‚çš„åˆ†å‘

getResponseWithInterceptorChain()Â æ‹¦æˆªé“¾ , ï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰

Rxjava

Aå¯¹äºBå˜åŒ–åšå‡ºå¿«é€Ÿååº”ï¼ŒAå°±æ˜¯è§‚å¯Ÿè€…ï¼ŒBå°±æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œæ¯”å¦‚è­¦å¯Ÿç›¯å°å·ï¼Œåªè¦ä¸€å·å°±æŠ“äºº

å…¶å®æœ¬æ¥ æ˜¯ Observable.subscribe(Observer),ä¸è¿‡æ˜¯è¢«è§‚å¯Ÿè€…éœ€è¦æ“ä½œç¬¦ï¼Œ

    subscribeOn(): æŒ‡å®šObservable(è¢«è§‚å¯Ÿè€…)æ‰€åœ¨çš„çº¿ç¨‹ï¼Œæˆ–è€…å«åšäº‹ä»¶äº§ç”Ÿçš„çº¿ç¨‹ã€‚

    observeOn(): æŒ‡å®š Observer(è§‚å¯Ÿè€…)æ‰€è¿è¡Œåœ¨çš„çº¿ç¨‹ï¼Œæˆ–è€…å«åšäº‹ä»¶æ¶ˆè´¹çš„çº¿ç¨‹ã€‚

    Schedulerï¼Œç›¸å½“äºçº¿ç¨‹è°ƒåº¦å™¨ï¼Œè¯»ï¼šæ€æ”¹é›€äº†

    åŸç†ï¼š



    subscribeOn()

    Schedulers.io()ç”Ÿæˆçš„ä¸€ä¸ªçº¿ç¨‹è°ƒåº¦å¯¹è±¡,æ­¤å¯¹è±¡æ˜¯ç»´æŠ¤è¿™ä¸€ä¸ªçº¿ç¨‹æ± ,è®©æ“ä½œåœ¨ioçº¿ç¨‹æ± ä¸­æ‰§è¡Œ

    observeOn()

    æ ¹æ® mainThread() æºç çš„è°ƒç”¨å…³ç³»æ¥çœ‹ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ HandlerScheduler å¯¹è±¡ï¼ŒHandlerScheduler 

    æ˜¯ä¸€ä¸ª Scheduler çš„å­ç±»ï¼Œå…¶å†…éƒ¨å°è£…äº†ä¸€ä¸ªå¯ä»¥åœ¨ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯çš„ handler å¯¹è±¡ã€‚çœ‹åˆ°è¿™é‡Œå°±å¤§æ¦‚æ˜ç™½äº†ï¼Œ

å°† observer
åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹å»æ¥æ”¶äº‹ä»¶ï¼Œå†…éƒ¨å°±æ˜¯é€šè¿‡ä¸€ä¸ªå¯ä»¥åœ¨ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯çš„ Handler
å»å®ç°çš„ã€‚

Retrofit

å°±æ˜¯ä¸ºå¼€å‘è€…èŠ‚çœè¿™éƒ¨åˆ†çš„å·¥ä½œé‡ï¼ŒRetrofitä¸€æ–¹é¢ä»åº•å±‚ç»Ÿä¸€ç”¨OkHttpå»åšç½‘ç»œå¤„ç†ï¼›å¦
ä¸€æ–¹é¢åœ¨å¤–å±‚çµæ´»æä¾›èƒ½ç›´æ¥èå…¥ä¸šåŠ¡é€»è¾‘çš„Callç½‘ç»œè®¿é—®å¯¹è±¡ã€‚

å…·ä½“æ¥è¯´ï¼ŒRetrofitåªè´Ÿè´£ç”Ÿäº§å¯¹è±¡ï¼Œç”Ÿäº§èƒ½åšç½‘ç»œè¯·æ±‚çš„å·¥ä½œå¯¹è±¡ï¼Œä»–æœ‰ç‚¹åƒä¸€ä¸ªå·¥å‚ï¼Œåª
æä¾›äº§å“ï¼Œå·¥å‚æœ¬èº«ä¸å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œäº§å“æ‰èƒ½å¤„ç†ç½‘ç»œè¯·æ±‚ã€‚

Glide

Glideå®ç°äº†å†…å­˜ç¼“å­˜å’Œç£ç›˜ç¼“å­˜ï¼Œä¸”éƒ½è®¾ç½®äº†ç›¸åº”çš„å¤§å°ï¼Œå¹¶æ ¹æ®lrusç®—æ³•è¿›è¡Œæ›´æ–°å’Œåˆ é™¤ã€‚

Glideå°†åŠ è½½äº†çš„å›¾ç‰‡æ·»åŠ åˆ°Map(Key, ResourceWeakReference)ä¸­å®ç°å†…å­˜ç¼“å­˜ã€‚

Glideçš„åŠ è½½é¡ºåºæ˜¯å…ˆä»å†…å­˜ä¸­è·å–,è‹¥æ²¡æœ‰åˆ™ä»ç£ç›˜ä¸­è·å–,åœ¨æ²¡æœ‰åˆ™é€šè¿‡ç½‘ç»œè·å–ã€‚ä»ç½‘ç»œä¸Šè·å–åˆ°äº†å›¾ç‰‡ä¹‹åè‹¥è®¾ç½®äº†å¯ç¼“å­˜,åˆ™ä¼šç¼“å­˜åˆ°ç£ç›˜ä¸­;ç„¶ååœ¨é€šè¿‡ç›¸åº”çš„åŠ è½½å‚æ•°è¿›è¡Œè§£ç å‹ç¼©è£å‰ªç­‰æ“ä½œä¹‹åå¾—åˆ°å›¾ç‰‡è®¾ç½®ç»™ImageView,åŒæ—¶ç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚

Glideé€šè¿‡ä¸ºå½“å‰Activityæ·»åŠ ä¸€ä¸ªfragmentæ¥ç›‘å¬ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•,ä»è€Œå®ç°åŠ è½½ä¸Activityç”Ÿå‘½å‘¨æœŸç»‘å®š,onstartæ—¶è¿›è¡ŒåŠ è½½ã€onstopæ—¶åœæ­¢åŠ è½½ç­‰ã€‚

5ã€Glideåœ¨å¼€å§‹åŠ è½½å›¾ç‰‡æ—¶,ä¼šç»™å½“å‰ViewTargetè®¾ç½®å¯¹åº”çš„Request,åŒæ—¶ä¹Ÿä¼šViewTargetä¸­çš„Viewè®¾ç½®tagä¸ºRequestã€‚åœ¨listViewå¤ç”¨æ—¶æœ‰äº†è¿™ä¸ªTagå€¼,ä»è€Œè§£å†³é”™ä¹±çš„é—®é¢˜

bitmapå¯¹è±¡æ± ï¼Œç”¨æ¥å­˜å‚¨bitmapå¯¹è±¡

MVC MVP

Androidä¸­æœ€å…¸å‹MVCæ˜¯ListViewï¼Œè¦æ˜¾ç¤ºçš„æ•°æ®æ˜¯Modelï¼Œç•Œé¢ä¸­çš„ListViewæ˜¯Viewï¼Œæ§åˆ¶æ•°æ®æ€æ ·åœ¨ListViewä¸­æ˜¾ç¤ºæ˜¯Controllerã€‚

å½“ç”¨æˆ·å‘è§¦äº‹ä»¶çš„æ—¶å€™ï¼Œviewå±‚ä¼šå‘é€æŒ‡ä»¤åˆ°controllerå±‚ï¼Œæ¥ç€controllerå»é€šçŸ¥modelå±‚æ›´æ–°æ•°æ®ï¼Œmodelå±‚æ›´æ–°å®Œæ•°æ®ä»¥åç›´æ¥æ˜¾ç¤ºåœ¨viewå±‚ä¸Šï¼Œè¿™å°±æ˜¯MVCçš„å·¥ä½œåŸç†ã€‚

Mvp

V ç»™Viewä¸€ä¸ª æ¥å£ ï¼Œ é‡Œé¢æœ‰æ“ä½œè§†å›¾çš„æ–¹æ³• ï¼Œæ¯”å¦‚showloading

M ç»™modelä¸€ä¸ªæ¥å£ï¼Œ é‡Œé¢æ˜¯é€»è¾‘æ–¹æ³• ï¼Œæ¯”å¦‚ç™»å½• loginé€»è¾‘ï¼Œä¼ å…¥ä¸šåŠ¡ç±»ç›‘å¬

P å†™ä¸€ä¸ªæ–¹æ³• ï¼Œä¸­ç”¨ modelå»è°ƒç”¨modelæ–¹æ³•ï¼Œä¼ å…¥viewå‚æ•°ï¼Œæ¯”å¦‚
view.getname ä»€ä¹ˆçš„

Vmpl å®ç°v ï¼Œå®ç°æ–¹æ³• ï¼Œæ‹¿åˆ°p çš„å®ä½“ ï¼Œä¼ å…¥è‡ªå·± ï¼Œç›´æ¥è°ƒç”¨pæ–¹æ³•

å¯¹äºAndroidè°ƒç”¨JSä»£ç çš„æ–¹æ³•æœ‰2ç§ï¼š

é€šè¿‡WebViewçš„loadUrlï¼ˆï¼‰

é€šè¿‡WebViewçš„evaluateJavascriptï¼ˆï¼‰

å¯¹äºJSè°ƒç”¨Androidä»£ç çš„æ–¹æ³•æœ‰3ç§ï¼š

é€šè¿‡WebViewçš„addJavascriptInterfaceï¼ˆï¼‰è¿›è¡Œå¯¹è±¡æ˜ å°„

é€šè¿‡ WebViewClient çš„shouldOverrideUrlLoading ()æ–¹æ³•å›è°ƒæ‹¦æˆª url

é€šè¿‡ WebChromeClient
çš„onJsAlert()ã€onJsConfirm()ã€onJsPromptï¼ˆï¼‰æ–¹æ³•å›è°ƒæ‹¦æˆªJSå¯¹è¯æ¡†alert()ã€confirm()ã€promptï¼ˆï¼‰
æ¶ˆæ¯

3ã€åŒé‡æ£€æŸ¥é”å®šï¼ˆDouble CheckLockï¼‰å®ç°å•ä¾‹

ç‰¹ç‚¹ï¼šå»¶è¿ŸåŠ è½½ï¼Œè§£å†³äº†å¤šä½™çš„åŒæ­¥ï¼Œçº¿ç¨‹å®‰å…¨ã€‚

ä¸¤æ¬¡åˆ¤ç©ºï¼Œç¬¬ä¸€å±‚æ˜¯ä¸ºäº†é¿å…ä¸å¿…è¦çš„åŒæ­¥ã€‚
ç¬¬äºŒå±‚æ˜¯ä¸ºäº†åœ¨instanceä¸ºnullçš„æƒ…å†µä¸‹åˆ›å»ºå®ä¾‹ã€‚

ä¸€ä¸ªç§æœ‰çš„é™æ€æˆå‘˜å˜é‡

ä¸€ä¸ªå…¬å¼€çš„é™æ€è·å–æ–¹æ³•

æ–¹æ³•ä¸­ç¬¬ä¸€æ¬¡åˆ¤æ–­ç©ºï¼Œç¬¬äºŒæ¬¡åœ¨åŒæ­¥æ–¹æ³•ä¸­åˆ¤æ–­ç©º

public class Singleton {

    private static Singleton instance = null;



    private Singleton () {

    }



    public static Singleton getInstance () {

        // If already initialized, no need to get lock everytime.

        if (instance == null) {

            synchronized (Singleton.class) {  //è®°ä½åŒæ­¥é”åŠ åœ¨æ–¹æ³•ä¸Š

                if (instance == null) {

                    instance = new Singleton();

                }

            }

        }

        return instance ;

    }

}

è®¾è®¡æ¨¡å¼

å·¥å‚æ–¹æ³•æ¨¡å¼

ç”¨å¤„ï¼š

1Â åˆ›å»ºæŠ½è±¡äº§å“ç±»ï¼Œå®šä¹‰å…¬å…±æ¥å£ï¼š

2åˆ›å»ºå…·ä½“äº§å“ç±»ï¼Œç»§æ‰¿Productç±»ï¼š

3 åˆ›å»ºæŠ½è±¡å·¥å‚ç±»ï¼Œå®šä¹‰å…¬å…±æ¥å£

4 åˆ›å»ºå…·ä½“å·¥å‚ç±»ï¼Œç»§æ‰¿æŠ½è±¡å·¥å‚ç±»ï¼Œå®ç°åˆ›å»ºå…·ä½“çš„äº§å“

//äº§å“A

        Factory factoryA = new FactoryA();

        Product productA = factoryA.create();

        productA.show();

        //äº§å“B

        Factory factoryB = new FactoryB();

        Product productB = factoryB.create();

        productB.show();

å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚ç”Ÿæˆå¤æ‚å¯¹è±¡æ—¶ï¼Œæ— éœ€çŸ¥é“å…·ä½“ç±»åï¼Œåªéœ€çŸ¥é“ç›¸åº”çš„å·¥å‚æ–¹æ³•å³å¯ã€‚

ç¼ºç‚¹

ä¸€ä¸ªå…·ä½“å·¥å‚åªèƒ½åˆ›å»ºä¸€ç§å…·ä½“äº§å“ã€‚

å¢åŠ æ–°äº§å“æ—¶ï¼Œè¿˜éœ€å¢åŠ ç›¸åº”çš„å·¥å‚ç±»ï¼Œç³»ç»Ÿç±»çš„ä¸ªæ•°å°†æˆå¯¹å¢åŠ ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦å’Œæ€§èƒ½å¼€é”€ã€‚

å¼•å…¥çš„æŠ½è±¡ç±»ä¹Ÿä¼šå¯¼è‡´ç±»ç»“æ„çš„å¤æ‚åŒ–ã€‚

ç®€å•å·¥å‚æ¨¡å¼

1 åˆ›å»ºæŠ½è±¡äº§å“ç±»ï¼Œå®šä¹‰å…¬å…±æ¥å£ï¼š

2 åˆ›å»ºå…·ä½“äº§å“ç±»ï¼Œç»§æ‰¿Productç±»ï¼š

3 åˆ›å»ºå·¥å‚ç±»ï¼Œåˆ›å»ºå…·ä½“çš„äº§å“ï¼š

Factory.create("A").show();//ç”Ÿäº§ProductA

Factory.create("B").show();//ç”Ÿäº§ProductB

ç”Ÿæˆå¤æ‚å¯¹è±¡æ—¶ï¼Œç¡®å®šåªæœ‰ä¸€ä¸ªå·¥å‚ç±»ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ã€‚å¦åˆ™æœ‰å¤šä¸ªå·¥å‚ç±»çš„è¯ï¼Œä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚

æŠ½è±¡å·¥å‚æ¨¡å¼

å®šä¹‰ï¼šä¸ºåˆ›å»ºä¸€ç»„ç›¸å…³æˆ–è€…ç›¸äº’ä¾èµ–çš„å¯¹è±¡æä¾›ä¸€ä¸ªæ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬çš„å…·ä½“ç±»ã€‚

1 åˆ›å»ºæŠ½è±¡äº§å“ç±» å®šä¹‰å…¬å…±æ¥å£ï¼š

Â 2åˆ›å»ºå…·ä½“äº§å“ç±» ç»§æ‰¿Productç±»ï¼šï¼ˆ2ä¸ªï¼‰

3 åˆ›å»ºæŠ½è±¡å·¥å‚ç±» å®šä¹‰å·¥å‚ä¸­ç”¨æ¥åˆ›å»ºä¸åŒäº§å“çš„æ–¹æ³•

4 åˆ›å»ºå…·ä½“å·¥å‚ç±» ç»§æ‰¿Factoryç±»ï¼š

ComputerFactory lenovoComputerFactory = new LenovoComputerFactory();

        lenovoComputerFactory.createCPU().showCPU();

        lenovoComputerFactory.createMemory().showMemory();

        lenovoComputerFactory.createHD().showHD();

å±å¹•çš„é€‚é…

éå¸¸å¥½çš„é—®é¢˜ ğŸ‘ï¼ "å±å¹•é€‚é…" æ˜¯ Android UI å¼€å‘ä¸­æ°¸è¿œç»•ä¸å¼€çš„æ ¸å¿ƒè¯é¢˜ã€‚
æˆ‘ä»¬æ¥ç³»ç»Ÿè®²ä¸€éï¼š

ä¸€ã€ä¸ºä»€ä¹ˆè¦åšå±å¹•é€‚é…

å› ä¸º Android è®¾å¤‡ç¢ç‰‡åŒ–ä¸¥é‡ï¼š

ğŸ§  äºŒã€æ ¸å¿ƒæ¦‚å¿µï¼šdpã€spã€pxã€dpi

ğŸ’¡ å…¬å¼ï¼š

px = dp Ã— (dpi / 160)

ä¾‹ï¼šåœ¨ 320dpi å±å¹•ä¸Šï¼Œ1dp = 2pxã€‚

ğŸ“ ä¸‰ã€æœ€åŸºæœ¬çš„é€‚é…æ–¹æ³•ï¼šdp + sp

âœ… åŸåˆ™ï¼š

æ‰€æœ‰å¸ƒå±€å°ºå¯¸ç”¨ dp

æ‰€æœ‰æ–‡å­—å°ºå¯¸ç”¨ sp

ä¸ç›´æ¥å†™ px

ğŸ“ç¤ºä¾‹ï¼š

`<TextView

    android:layout_width="100dp"

    android:layout_height="50dp"

    android:textSize="16sp" />`{=html}

è¿™æ ·ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®è®¾å¤‡å¯†åº¦è¿›è¡Œç¼©æ”¾ã€‚

ğŸ§© å››ã€ä¸åŒåˆ†è¾¨ç‡èµ„æºç›®å½•é€‚é…

Android æä¾›äº†å¤šå¥—èµ„æºç›®å½•ï¼š

âœ… æŠŠä¸åŒåˆ†è¾¨ç‡çš„å›¾ç‰‡æ”¾åœ¨ä¸åŒæ–‡ä»¶å¤¹ä¸­ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ã€‚

ä¾‹ï¼š

res/

â”œâ”€ drawable-hdpi/logo.png (72x72)

â”œâ”€ drawable-xhdpi/logo.png (96x96)

â””â”€ drawable-xxhdpi/logo.png (144x144)

ğŸ§­ äº”ã€å¸¸ç”¨çš„å±å¹•é€‚é…æ–¹æ¡ˆï¼ˆé‡ç‚¹ï¼‰

âœ… 1ï¸âƒ£ ç›¸å¯¹å¸ƒå±€ & ç™¾åˆ†æ¯”å¸ƒå±€

è®©æ§ä»¶æ ¹æ®çˆ¶å®¹å™¨åŠ¨æ€è°ƒæ•´å¤§å°ã€‚

ğŸŸ¢ ConstraintLayoutï¼ˆæ¨èï¼‰

å¯ç²¾ç¡®æ§åˆ¶æ¯”ä¾‹ï¼š

`<ImageView

    android:layout_width="0dp"

    android:layout_height="0dp"

    app:layout_constraintDimensionRatio="16:9"

    app:layout_constraintTop_toTopOf="parent"

    app:layout_constraintStart_toStartOf="parent"

    app:layout_constraintEnd_toEndOf="parent"/>`{=html}

ä¿æŒ 16:9 æ¯”ä¾‹ï¼Œè‡ªé€‚åº”å®½é«˜ã€‚

âœ… 2ï¸âƒ£ ä½¿ç”¨ weightsum æˆ– layout_weight

çº¿æ€§å¸ƒå±€ç­‰åˆ†å®½é«˜ï¼š

`<LinearLayout

    android:orientation="horizontal"

    android:weightSum="3">`{=html}

    <View

        android:layout_width="0dp"

        android:layout_height="match_parent"

        android:layout_weight="1" />



    ...

`</LinearLayout>`{=html}

âœ… 3ï¸âƒ£ ä½¿ç”¨é™å®šç¬¦ï¼ˆQualifierï¼‰

ä¾‹å¦‚ï¼š

values-sw360dp/

values-sw480dp/

values-sw600dp/

ç³»ç»Ÿä¼šæ ¹æ® æœ€å°å®½åº¦ swï¼ˆsmallest widthï¼‰è‡ªåŠ¨é€‰æ‹©èµ„æºã€‚

é€šå¸¸ç”¨äºå¹³æ¿é€‚é…ï¼Œä¾‹å¦‚ï¼š

æ‰‹æœºç”¨ values-sw360dp

å¹³æ¿ç”¨ values-sw600dp

âœ… 4ï¸âƒ£ AutoSize è‡ªåŠ¨é€‚é…æ–¹æ¡ˆï¼ˆå®˜æ–¹æ¨èï¼‰

Android 8.0 åå®˜æ–¹æä¾› Density è‡ªé€‚åº”æ–¹æ¡ˆ

åœ¨ AndroidManifest.xml ä¸­æ·»åŠ ï¼š

`<application

    android:resizeableActivity="true"

    android:supportsRtl="true"

    android:largeHeap="true"

    tools:replace="android:resizeableActivity" />`{=html}

å¹¶åœ¨ resources ä¸­å®šä¹‰ä¸åŒ dimens.xmlï¼š

values-sw360dp/dimens.xml

values-sw480dp/dimens.xml

values-sw600dp/dimens.xml

âœ… 5ï¸âƒ£ ä»Šæ—¥æœ€ä¸»æµæ–¹æ¡ˆï¼šAndroidAutoSizeï¼ˆé€‚é…æ‰€æœ‰å±å¹•ï¼‰

ä¸‰æ–¹åº“ï¼šAndroidAutoSize å¯å®ç°ï¼š

æŒ‰è®¾è®¡ç¨¿å®½é«˜ç­‰æ¯”ä¾‹ç¼©æ”¾

æ”¯æŒ Activity/Fragment ç‹¬ç«‹é€‚é…

æ”¯æŒ dp/sp è‡ªåŠ¨è½¬æ¢

é…ç½®ï¼š

implementation 'me.jessyan:autosize:1.2.1'

ä½¿ç”¨ï¼š

AutoSizeConfig.getInstance()

        .setBaseOnWidth(true)

        .setDesignWidthInDp(360);

æ•ˆæœï¼šä¸åŒå±å¹•è‡ªåŠ¨æŒ‰è®¾è®¡å›¾æ¯”ä¾‹ç¼©æ”¾ã€‚

âœ… 6ï¸âƒ£ è‡ªå®šä¹‰ Density é€‚é…ï¼ˆå¤´æ¡æ–¹æ¡ˆï¼‰

å­—èŠ‚è·³åŠ¨ï¼ˆæŠ–éŸ³ã€ä»Šæ—¥å¤´æ¡ï¼‰ä½¿ç”¨çš„é€‚é…åŸç†ã€‚

ğŸ“˜ æ ¸å¿ƒæ€æƒ³ï¼š

åŠ¨æ€ä¿®æ”¹ DisplayMetrics.densityï¼Œè®© UI å°ºå¯¸æŒ‰ç…§è®¾è®¡ç¨¿å®½åº¦ç¼©æ”¾ã€‚

public static void setCustomDensity(Activity activity, Application
application) {

    DisplayMetrics appDisplayMetrics = application.getResources().getDisplayMetrics();

    float targetDensity = appDisplayMetrics.widthPixels / 360f; // è®¾è®¡å›¾å®½åº¦

    float targetScaledDensity = targetDensity * (appDisplayMetrics.scaledDensity / appDisplayMetrics.density);

    int targetDensityDpi = (int) (160 * targetDensity);



    appDisplayMetrics.density = targetDensity;

    appDisplayMetrics.scaledDensity = targetScaledDensity;

    appDisplayMetrics.densityDpi = targetDensityDpi;



    DisplayMetrics activityDisplayMetrics = activity.getResources().getDisplayMetrics();

    activityDisplayMetrics.density = targetDensity;

    activityDisplayMetrics.scaledDensity = targetScaledDensity;

    activityDisplayMetrics.densityDpi = targetDensityDpi;

}

ğŸ‘‰ è¿™æ ·å¯å®ç°"æ‰€æœ‰è®¾å¤‡å®½åº¦ç»Ÿä¸€ä¸º 360dp åŸºå‡†"çš„æ•ˆæœã€‚

ğŸ§® å…­ã€å­—ä½“é€‚é…ç­–ç•¥

å­—ä½“ç»Ÿä¸€ç”¨ sp

ä¸åŒè®¾å¤‡å­—ä½“å¤§å°ä¸ä¸€è‡´æ—¶ï¼Œå¯ä½¿ç”¨ï¼š

android:includeFontPadding="false"

æˆ–åœ¨è®¾è®¡ä¸­å®šä¹‰æœ€å¤§æœ€å°å­—ä½“ï¼š

android:autoSizeTextType="uniform"

android:autoSizeMinTextSize="10sp"

android:autoSizeMaxTextSize="18sp"

ğŸ§­ ä¸ƒã€åˆ˜æµ·å± / å…¨é¢å± / çŠ¶æ€æ é€‚é…

1ï¸âƒ£ åˆ¤æ–­æ˜¯å¦æœ‰åˆ˜æµ·ï¼š

WindowInsets insets = view.getRootWindowInsets();

DisplayCutout cutout = insets.getDisplayCutout();

if (cutout != null) { /\* æœ‰åˆ˜æµ· \*/ }

2ï¸âƒ£ è®©å†…å®¹å»¶ä¼¸åˆ°çŠ¶æ€æ ï¼š

WindowCompat.setDecorFitsSystemWindows(window, false);

3ï¸âƒ£ ä½¿ç”¨ fitsSystemWindowsï¼š

android:fitsSystemWindows="true"

ğŸ§© å…«ã€æ¨ªç«–å±é€‚é…

åœ¨ AndroidManifestï¼š

android:configChanges="orientation\|screenSize"

æˆ–é€šè¿‡èµ„æºç›®å½•ï¼š

layout-land/ â†’ æ¨ªå±å¸ƒå±€

layout-port/ â†’ ç«–å±å¸ƒå±€

ğŸ’¡ ä¹ã€é€‚é…æ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾ï¼‰

å±å¹•é€‚é…

â”‚

â”œâ”€ å•ä½é€‚é…ï¼šdpã€sp

â”œâ”€ å›¾ç‰‡é€‚é…ï¼šdrawable-xxxhdpi

â”œâ”€ å¸ƒå±€é€‚é…ï¼šConstraintLayout / weight

â”œâ”€ èµ„æºé™å®šç¬¦ï¼švalues-sw600dp

â”œâ”€ è‡ªåŠ¨é€‚é…åº“ï¼šAndroidAutoSize

â”œâ”€ Density åŠ¨æ€ä¿®æ”¹æ–¹æ¡ˆ

â”œâ”€ å­—ä½“é€‚é…ï¼šsp / autoSizeTextType

â”œâ”€ ç‰¹æ®Šå±é€‚é…ï¼šåˆ˜æµ·å±ã€æ¨ªç«–å±

â””â”€ è°ƒè¯•å·¥å…·ï¼šLayout Inspector / Density Test

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ ç”»ä¸€ä¸ª ã€Œå±å¹•é€‚é…æ€ç»´å¯¼å›¾ + å®æˆ˜ç¤ºä¾‹ä»£ç ã€ï¼Ÿ åŒ…æ‹¬ï¼š âœ…
AutoSize é…ç½®æ­¥éª¤ âœ… å¤´æ¡æ–¹æ¡ˆå®Œæ•´å°è£…ç±» âœ… ä¸åŒ dpi ä¸‹æ•ˆæœå¯¹æ¯”å›¾
å¯ç›´æ¥æ”¾ä½ é¡¹ç›®é‡Œä½¿ç”¨ã€‚

Android ç³»ç»Ÿos

ç¬¬ä¸€ã€æ“ä½œç³»ç»Ÿå±‚ï¼ˆOSï¼‰

ç¬¬äºŒã€å„ç§åº“ï¼ˆLibrariesï¼‰å’ŒAndroid è¿è¡Œç¯å¢ƒï¼ˆRunTimeï¼‰

ç¬¬ä¸‰ã€åº”ç”¨ç¨‹åºæ¡†æ¶ï¼ˆApplication Frameworkï¼‰

ç¬¬å››ã€åº”ç”¨ç¨‹åºï¼ˆApplicationï¼‰

Android æ€§èƒ½ä¼˜åŒ–

å·¥å…·ä½¿ç”¨æµç¨‹ï¼š

Memory --\>å†…å­˜æ³„æ¼å‘ç”Ÿæ—¶çš„ä¸»è¦è¡¨ç°ä¸ºå†…å­˜æŠ–åŠ¨(çœ‹å›¾ï¼‰--ã€‹å°† heap dump
ä¿å­˜ä¸º HPROF

é€šè¿‡åŒ…åæ¥è¿›è¡ŒæŸ¥æ‰¾ --ã€‹ä¸€å±‚çš„å±‚

Ddms é€‰ä¸­ä¸€åº”ç”¨è¿›è¡Œæµ‹è¯•å°±å¯ä»¥ ï¼Œç‚¹å‡»ä¸Šé¢çš„çº¿ç¨‹æ ‡è®°ï¼Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­æ“ä½œä¸€é
ï¼Œ å…³é—­çº¿ç¨‹æ ‡è®° ï¼Œ

Hierarchy Vieweræä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ç•Œé¢æ¥è§‚æµ‹å¸ƒå±€çš„å±‚çº§,
è®©æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–å¸ƒå±€å±‚çº§, åˆ é™¤å¤šä½™çš„ä¸å¿…è¦çš„Viewå±‚çº§, æå‡å¸ƒå±€é€Ÿåº¦

TraceViewä¸€ä¸ªå›¾å½¢åŒ–çš„å·¥å…·,
ç”¨æ¥å±•ç¤ºå’Œåˆ†ææ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ã€‚ä¹Ÿæ˜¯ä¸€æ¬¾æ€§èƒ½ä¼˜åŒ–çš„ç¥å™¨ã€‚å¯ä»¥é€šè¿‡åƒæ‰“logä¸€æ ·çš„æ–¹å¼å»å®šä½ä»£ç çš„æ‰§è¡Œæ—¶é—´ï¼Œä»è€Œå¯ä»¥å‡†ç¡®å®šä½æ˜¯å“ªä¸€æ®µä»£ç çš„æ‰§è¡Œæ¶ˆè€—äº†å¤ªå¤šæ—¶é—´ã€‚ç›¸æ¯”SysTraceï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ›´å¤æ‚ã€‚

å¡é¡¿ï¼šæ¯ä¸ª View
ç»˜åˆ¶ä¸­æœ‰ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼šMeasureã€Layoutã€Drawã€‚å…·ä½“å®ç°æ˜¯ä» ViewRootImp
ç±»çš„performTraversals() æ–¹æ³•å¼€å§‹æ‰§è¡Œï¼ŒMeasure å’Œ
Layoutéƒ½æ˜¯é€šè¿‡é€’å½’æ¥è·å– View
çš„å¤§å°å’Œä½ç½®ï¼Œå¹¶ä¸”ä»¥æ·±åº¦ä½œä¸ºä¼˜å…ˆçº§ï¼Œå¯ä»¥çœ‹å‡ºå±‚çº§è¶Šæ·±ã€å…ƒç´ è¶Šå¤šã€è€—æ—¶ä¹Ÿå°±è¶Šé•¿ã€‚

Android ç³»ç»Ÿæ¯éš” 16ms å‘å‡º VSYNC ä¿¡å·ï¼Œè§¦å‘å¯¹ UI
è¿›è¡Œæ¸²æŸ“ï¼Œå¦‚æœæŸä¸ªæ“ä½œèŠ±è´¹çš„æ—¶é—´æ˜¯ 24ms ï¼Œç³»ç»Ÿåœ¨å¾—åˆ° VSYNC
ä¿¡å·æ—¶å°±æ— æ³•æ­£å¸¸è¿›è¡Œæ­£å¸¸æ¸²æŸ“ï¼Œè¿™æ ·å°±å‘ç”Ÿäº†ä¸¢å¸§ç°è±¡ã€‚

é‚£å¸ƒå±€ä¼˜åŒ–æœ‰å“ªäº›æ–¹æ³•å‘¢ï¼Œä¸»è¦é€šè¿‡å‡å°‘å±‚çº§ã€å‡å°‘æµ‹é‡å’Œç»˜åˆ¶æ—¶é—´ã€æé«˜å¤ç”¨æ€§ä¸‰ä¸ªæ–¹é¢å…¥æ‰‹ã€‚æ€»ç»“å¦‚ä¸‹ï¼š

å‡å°‘å±‚çº§ã€‚åˆç†ä½¿ç”¨ RelativeLayout å’Œ LinerLayoutï¼Œåˆç†ä½¿ç”¨Mergeã€‚

æé«˜æ˜¾ç¤ºé€Ÿåº¦ã€‚ä½¿ç”¨
ViewStubï¼Œå®ƒæ˜¯ä¸€ä¸ªçœ‹ä¸è§çš„ã€ä¸å å¸ƒå±€ä½ç½®ã€å ç”¨èµ„æºéå¸¸å°çš„è§†å›¾å¯¹è±¡ã€‚`<ViewStub    android:layout="@layout/layout_to_show">`{=html}

ViewStubã€‚å¯ä»¥åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ‡’åŠ è½½çš„æ¨¡å¼inflateè¿›å¸ƒå±€èµ„æºä¸­å½“ä¸€ä¸ªViewStubçš„inflate()æ–¹æ³•è¢«è°ƒç”¨æˆ–è€…è¢«è®¾ä¸ºæ˜¾ç¤ºæ—¶ï¼Œè¿™ä¸ªViewStubä½¿ç”¨è®¾å®šçš„Viewæ‰ä¼šè¢«åŠ è½½ï¼Œå¹¶æ›¿æ¢å½“å‰ViewStubçš„ä½ç½®ã€‚å› æ­¤ï¼ŒViewStubå­˜åœ¨äºè§†å›¾å±‚æ¬¡ï¼Œç›´åˆ°setVisibility(int)æˆ–inflate()æ–¹æ³•è¢«è°ƒç”¨ï¼Œå¦åˆ™æ˜¯ä¸åŠ è½½æ§ä»¶çš„ï¼Œæ‰€ä»¥æ¶ˆè€—çš„èµ„æºå°ã€‚é€šå¸¸ä¹Ÿå«å®ƒä¸º"æ‡’æƒ°çš„include"ã€‚

å¸ƒå±€å¤ç”¨ã€‚å¯ä»¥é€šè¿‡Â æ ‡ç­¾æ¥æé«˜å¤ç”¨ã€‚

å°½å¯èƒ½å°‘ç”¨wrap_contentã€‚wrap_content ä¼šå¢åŠ å¸ƒå±€ measure
æ—¶è®¡ç®—æˆæœ¬ï¼Œåœ¨å·²çŸ¥å®½é«˜ä¸ºå›ºå®šå€¼æ—¶ï¼Œä¸ç”¨wrap_content ã€‚

åˆ é™¤æ§ä»¶ä¸­æ— ç”¨çš„å±æ€§ã€‚

è¿‡åº¦ç»˜åˆ¶ï¼š

Profile GPU Renderingå·¥å…·æ‰‹æœºä¸­çš„

å¸ƒå±€ä¸Šçš„ä¼˜åŒ–ã€‚ç§»é™¤ XML ä¸­éå¿…é¡»çš„èƒŒæ™¯ï¼Œç§»é™¤ Window
é»˜è®¤çš„èƒŒæ™¯ã€æŒ‰éœ€æ˜¾ç¤ºå ä½èƒŒæ™¯å›¾ç‰‡

è‡ªå®šä¹‰Viewä¼˜åŒ–ã€‚ä½¿ç”¨
canvas.clipRect()æ¥å¸®åŠ©ç³»ç»Ÿè¯†åˆ«é‚£äº›å¯è§çš„åŒºåŸŸï¼Œåªæœ‰åœ¨è¿™ä¸ªåŒºåŸŸå†…æ‰ä¼šè¢«ç»˜åˆ¶ã€‚

å¯åŠ¨ä¼˜åŒ–

UI å¸ƒå±€ã€‚åº”ç”¨ä¸€èˆ¬éƒ½æœ‰é—ªå±é¡µï¼Œä¼˜åŒ–é—ªå±é¡µçš„ UI å¸ƒå±€ï¼Œå¯ä»¥é€šè¿‡ Profile GPU
Rendering æ£€æµ‹ä¸¢å¸§æƒ…å†µã€‚

å¯åŠ¨åŠ è½½é€»è¾‘ä¼˜åŒ–ã€‚å¯ä»¥é‡‡ç”¨åˆ†å¸ƒåŠ è½½ã€å¼‚æ­¥åŠ è½½ã€å»¶æœŸåŠ è½½ç­–ç•¥æ¥æé«˜åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚

æ•°æ®å‡†å¤‡ã€‚æ•°æ®åˆå§‹åŒ–åˆ†æï¼ŒåŠ è½½æ•°æ®å¯ä»¥è€ƒè™‘ç”¨çº¿ç¨‹åˆå§‹åŒ–ç­‰ç­–ç•¥ã€‚

åˆç†çš„åˆ·æ–°æœºåˆ¶

ç¼©å°åˆ·æ–°åŒºåŸŸ

ä¼˜åŒ–å†…å­˜ç©ºé—´

å¯¹è±¡å¼•ç”¨ã€‚å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨å››ç§å¼•ç”¨ç±»å‹ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆç†ä½¿ç”¨ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„å¼•ç”¨ç±»å‹ã€‚

å‡å°‘ä¸å¿…è¦çš„å†…å­˜å¼€é”€ã€‚æ³¨æ„è‡ªåŠ¨è£…ç®±ï¼Œå¢åŠ å†…å­˜å¤ç”¨ï¼Œæ¯”å¦‚æœ‰æ•ˆåˆ©ç”¨ç³»ç»Ÿè‡ªå¸¦çš„èµ„æºã€è§†å›¾å¤ç”¨ã€å¯¹è±¡æ± ã€Bitmapå¯¹è±¡çš„å¤ç”¨ã€‚

ä½¿ç”¨æœ€ä¼˜çš„æ•°æ®ç±»å‹ã€‚æ¯”å¦‚é’ˆå¯¹æ•°æ®ç±»å®¹å™¨ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨ArrayMapæ•°æ®ç»“æ„ï¼Œé¿å…ä½¿ç”¨æšä¸¾ç±»å‹ï¼Œä½¿ç”¨ç¼“å­˜Lrucacheç­‰ç­‰ã€‚

å›¾ç‰‡å†…å­˜ä¼˜åŒ–ã€‚å¯ä»¥è®¾ç½®ä½å›¾è§„æ ¼ï¼Œæ ¹æ®é‡‡æ ·å› å­åšå‹ç¼©ï¼Œç”¨ä¸€äº›å›¾ç‰‡ç¼“å­˜æ–¹å¼å¯¹å›¾ç‰‡è¿›è¡Œç®¡ç†ç­‰ç­‰ã€‚

èµ„æºä¼˜åŒ–

resèµ„æºä¼˜åŒ–

ï¼ˆ1ï¼‰åªä½¿ç”¨ä¸€å¥—å›¾ç‰‡ï¼Œä½¿ç”¨é«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡ã€‚
ï¼ˆ2ï¼‰UIè®¾è®¡åœ¨pså®‰è£…TinyPNGæ’ä»¶ï¼Œå¯¹å›¾ç‰‡è¿›è¡Œæ— æŸå‹ç¼©ã€‚

æ€§èƒ½ä¼˜åŒ–

Android æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªç³»ç»Ÿæ€§å·¥ç¨‹ï¼Œæ¶µç›–
å¯åŠ¨é€Ÿåº¦ã€å†…å­˜ä½¿ç”¨ã€ç»˜åˆ¶æ•ˆç‡ã€è€—ç”µé‡ã€åŒ…ä½“ç§¯ã€ç½‘ç»œæ€§èƒ½
ç­‰å¤šä¸ªæ–¹é¢ã€‚ä¸‹é¢æˆ‘å¸®ä½ æ•´ç†ä¸€ä»½ **å…¨æ–¹ä½æ€§èƒ½ä¼˜åŒ–æ¸…å•ï¼ˆå«æ€è·¯ + å®è·µæ–¹æ³• +
å·¥å…·ï¼‰**ğŸ‘‡

ğŸ§© ä¸€ã€å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–ï¼ˆå†·å¯åŠ¨ & çƒ­å¯åŠ¨ï¼‰

1ï¸âƒ£ å†·å¯åŠ¨ä¼˜åŒ–

å†·å¯åŠ¨æŒ‡åº”ç”¨ä»è¿›ç¨‹æœªå¯åŠ¨çŠ¶æ€è¿›å…¥å¯äº¤äº’çŠ¶æ€ã€‚ ä¼˜åŒ–æ€è·¯ï¼š

å»¶è¿Ÿåˆå§‹åŒ–ï¼šéå¿…è¦ SDKã€ä¸‰æ–¹åº“å»¶ååˆ°é¦–é¡µåå†åˆå§‹åŒ–ã€‚

å‡å°‘ä¸»çº¿ç¨‹é˜»å¡ï¼šé¿å…åœ¨ Application.onCreate()ã€Activity.onCreate()
åšè€—æ—¶æ“ä½œã€‚

ä½¿ç”¨å¼‚æ­¥åŠ è½½ï¼šè€—æ—¶ä»»åŠ¡æ”¾å…¥åå°çº¿ç¨‹ã€‚

SplashActivity ä¼˜åŒ–ï¼šç”¨è½»é‡å¸ƒå±€ï¼Œé¿å…åŠ è½½å¤§å›¾ã€‚

MultiDex ä¼˜åŒ–ï¼šæå‰å®‰è£… MultiDex æˆ–ä½¿ç”¨ Android 5.0+ çš„ native
multidexã€‚

è°ƒè¯•å·¥å…·ï¼š

adb shell am start -W your.package/.MainActivity

Android Studio Profiler â†’ "Startup" åˆ†æ

TraceView æˆ– Systrace

ğŸ¨ äºŒã€UI ç»˜åˆ¶ä¸æµç•…åº¦ä¼˜åŒ–ï¼ˆæ‰å¸§ã€å¡é¡¿ï¼‰

ç›®æ ‡ï¼šä¿æŒ 16ms/å¸§ï¼ˆ60fpsï¼‰

å¸¸è§åŸå› ï¼š

ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆç½‘ç»œã€IOã€å¤æ‚è®¡ç®—ï¼‰

è¿‡åº¦ç»˜åˆ¶ï¼ˆOverdrawï¼‰

ä¸å¿…è¦çš„å¸ƒå±€å±‚çº§ï¼ˆView åµŒå¥—å¤ªæ·±ï¼‰

RecyclerView æ»‘åŠ¨å¡é¡¿ï¼ˆitem ç»‘å®šè€—æ—¶ï¼‰

ä¼˜åŒ–æªæ–½ï¼š

ä½¿ç”¨ å¸ƒå±€ä¼˜åŒ–å·¥å…·

Layout Inspector / Hierarchy Viewer

ä½¿ç”¨ ConstraintLayoutã€ViewStubã€merge å‡å°‘å±‚çº§

é¿å…è¿‡åº¦ç»˜åˆ¶

å¼€å‘è€…é€‰é¡¹ä¸­å¼€å¯"GPUè¿‡åº¦ç»˜åˆ¶è°ƒè¯•"ï¼Œè®©èƒŒæ™¯é€æ˜ã€å»æ‰å¤šä½™å±‚

å¼‚æ­¥æ›´æ–°UI

ä½¿ç”¨ Handlerã€Coroutineã€AsyncTaskï¼ˆä¸æ¨èï¼‰ç­‰ã€‚

RecyclerView ä¼˜åŒ–

å¼€å¯ setHasFixedSize(true)

ä½¿ç”¨ DiffUtil

ViewHolder ä¸­ç¼“å­˜èµ„æºï¼Œå‡å°‘ findViewById

ğŸ§  ä¸‰ã€å†…å­˜ä¼˜åŒ–ï¼ˆé¿å…OOMï¼‰

æ£€æŸ¥ç‚¹ï¼š

å¤§å›¾åŠ è½½ã€ç¼“å­˜æ³„æ¼ã€Context æ³„æ¼

Activity / Fragment / Singleton æŒæœ‰å¼•ç”¨æœªé‡Šæ”¾

Handler æœªç§»é™¤æ¶ˆæ¯ã€æœªæ³¨é”€æ³¨å†Œç›‘å¬

ä¼˜åŒ–æ‰‹æ®µï¼š

ä½¿ç”¨ LeakCanary æ£€æµ‹å†…å­˜æ³„æ¼

å›¾ç‰‡åŠ è½½ä¼˜åŒ–

ä½¿ç”¨ Glideã€Picassoã€Fresco

æŒ‰éœ€å‹ç¼©ã€ä½¿ç”¨ RGB_565ã€thumbnail

é¿å…å†…å­˜æŠ–åŠ¨

ä¸åœ¨ onDraw() å†…åˆ›å»ºå¯¹è±¡

å¾ªç¯ä¸­é¿å… String æ‹¼æ¥ï¼Œä½¿ç”¨ StringBuilder

âš¡ å››ã€CPU & è€—ç”µä¼˜åŒ–

å‡å°‘WakeLockï¼ˆä¿æŒCPUå”¤é†’ä¼šè€—ç”µï¼‰

å‡å°‘åå°è½®è¯¢ï¼ˆç”¨ WorkManager / AlarmManager ç²¾å‡†è°ƒåº¦ï¼‰

é™ä½é¢‘ç¹ç»˜åˆ¶

ä½¿ç”¨ invalidate() æ—¶ï¼Œå°½é‡æŒ‡å®šé‡ç»˜åŒºåŸŸ

åŠ¨ç”»ä¼˜åŒ–

ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿï¼ˆandroid:hardwareAccelerated="true"ï¼‰

é¿å…é¢‘ç¹å±æ€§åŠ¨ç”»å¼•èµ·è¿‡åº¦è®¡ç®—

å·¥å…·ï¼š

Battery Historian

Systrace

CPU Profiler

ğŸŒ äº”ã€ç½‘ç»œæ€§èƒ½ä¼˜åŒ–

è¯·æ±‚åˆå¹¶ï¼šå‡å°‘ HTTP æ¬¡æ•°

ç¼“å­˜ç­–ç•¥ï¼šä½¿ç”¨ OkHttp ç¼“å­˜æˆ–æœ¬åœ°æ•°æ®åº“ç¼“å­˜

Gzip å‹ç¼©ï¼šæœåŠ¡ç«¯å¯ç”¨å‹ç¼©

å›¾ç‰‡CDNï¼šæŒ‰éœ€åŠ è½½ä¸åŒåˆ†è¾¨ç‡

å¼±ç½‘ä¼˜åŒ–ï¼šé‡è¯•æœºåˆ¶ + é™çº§æ–¹æ¡ˆ

å·¥å…·ï¼š

Charlesã€Stethoã€OkHttp Interceptor

ğŸ“¦ å…­ã€åŒ…ä½“ç§¯ä¼˜åŒ–

åˆ é™¤æ— ç”¨èµ„æºï¼šres/raw, res/drawable

å‹ç¼©å›¾ç‰‡ï¼šWebP / avif

å¯ç”¨ Proguard / R8 æ··æ·†å‹ç¼©ä»£ç 

åŠ¨æ€åŠ è½½ï¼ˆSplit APKã€Feature Moduleï¼‰

ç§»é™¤æ— ç”¨çš„ä¸‰æ–¹åº“ä¾èµ–

ä½¿ç”¨ android:extractNativeLibs="false" å‡å°‘è§£å‹

ğŸ§° ä¸ƒã€æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

ä½¿ç”¨æ‰¹é‡æ’å…¥äº‹åŠ¡ï¼ˆbeginTransaction()ï¼‰

åˆç†ä½¿ç”¨ç´¢å¼•

Room / SQLite é…åˆ WAL æ¨¡å¼æé«˜å†™å…¥æ•ˆç‡

é¿å…ä¸»çº¿ç¨‹è®¿é—®æ•°æ®åº“ï¼ˆä½¿ç”¨å¼‚æ­¥ï¼‰

ğŸ”¬ å…«ã€æ€§èƒ½æ£€æµ‹å·¥å…·æ¸…å•

ğŸ’¡ ä¹ã€è¿›é˜¶ä¼˜åŒ–æ–¹å‘

ä½¿ç”¨ Jetpack Compose æå‡UIæ¸²æŸ“æ€§èƒ½ï¼ˆæ›´å°‘é‡ç»˜ï¼‰

å¤šè¿›ç¨‹æ¶æ„ åˆ†ç¦»ä¸»è¿›ç¨‹ä¸è€—æ—¶é€»è¾‘

é¢„åŠ è½½ / é¢„çƒ­æœºåˆ¶ï¼ˆå¦‚æå‰åŠ è½½é¦–é¡µæ•°æ®ï¼‰

å…¨é“¾è·¯æ€§èƒ½ç›‘æ§ç³»ç»Ÿï¼ˆç»“åˆ Firebase Performance / Matrixï¼‰

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ å‡ºä¸€ä»½ ã€ŒAndroid æ€§èƒ½ä¼˜åŒ–å®æˆ˜ checklistã€ï¼Ÿ âœ…
åŒ…å«ï¼šæ¯ä¸ªä¼˜åŒ–ç‚¹çš„"æ£€æµ‹æ–¹æ³• + å®ç°ä»£ç ç¤ºä¾‹ + å·¥å…·å‘½ä»¤"ã€‚
è¿™æ ·ä½ å¯ä»¥ç›´æ¥ç”¨åœ¨é¡¹ç›®é‡Œã€‚

å¤ªå¥½äº† ğŸ‘ ä¸‹é¢æ˜¯æˆ‘ä¸ºä½ æ•´ç†çš„ ã€ŠAndroid æ€§èƒ½ä¼˜åŒ–å®æˆ˜ Checklistã€‹ ------
è¿™ä»½æ¸…å•éå¸¸å®ç”¨ï¼Œèƒ½ç›´æ¥åº”ç”¨åœ¨ä½ è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚
å†…å®¹åŒ…æ‹¬ï¼šæ£€æµ‹æ–¹å¼ã€ä»£ç ç¤ºä¾‹ã€ä¼˜åŒ–å·¥å…·ã€å»ºè®®å®è·µã€‚

ğŸš€ Android æ€§èƒ½ä¼˜åŒ–å®æˆ˜ Checklist

ğŸ§© ä¸€ã€å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–

ğŸ¨ äºŒã€UI ç»˜åˆ¶ä¸æµç•…åº¦ä¼˜åŒ–

\

ğŸ§  ä¸‰ã€å†…å­˜ä¼˜åŒ–

âš¡ å››ã€CPU ä¸è€—ç”µä¼˜åŒ–

ğŸŒ äº”ã€ç½‘ç»œæ€§èƒ½ä¼˜åŒ–

ğŸ“¦ å…­ã€åŒ…ä½“ç§¯ä¼˜åŒ–

ğŸ’¾ ä¸ƒã€æ•°æ®åº“ä¼˜åŒ–

ğŸ” å…«ã€æ€§èƒ½æ£€æµ‹å·¥å…·æ±‡æ€»

ğŸ§° ä¹ã€å»ºè®®é¡¹ç›®å®æˆ˜é…ç½®ï¼ˆæ¨èï¼‰

æ”¾åˆ° Application é‡Œåˆå§‹åŒ–ï¼š

if (BuildConfig.DEBUG) {

    StrictMode.setThreadPolicy(

        new StrictMode.ThreadPolicy.Builder()

            .detectAll()

            .penaltyLog()

            .build()

    );

    StrictMode.setVmPolicy(

        new StrictMode.VmPolicy.Builder()

            .detectLeakedSqlLiteObjects()

            .detectLeakedClosableObjects()

            .penaltyLog()

            .build()

    );

}

æ·»åŠ æ€§èƒ½ç›‘æ§å…¥å£ï¼ˆè°ƒè¯•å¼€å…³ï¼‰ï¼š

Looper.getMainLooper().setMessageLogging(msg -\> {

    long now = System.currentTimeMillis();

    // æ£€æµ‹å¸§è€—æ—¶

});

ğŸ§  åã€ç»¼åˆä¼˜åŒ–å»ºè®®

âœ… "å…ˆé‡åŒ–ï¼Œåä¼˜åŒ–"------ç”¨æ•°æ®æ‰¾ç“¶é¢ˆ âœ…
"å¼‚æ­¥+ç¼“å­˜+å»¶è¿ŸåŠ è½½"------ä¸»çº¿ç¨‹å‡è´Ÿä¸‰æ³•å® âœ…
"å‡å°‘ç»˜åˆ¶å±‚çº§ã€å‡å°‘å†…å­˜å¯¹è±¡ã€å‡å°‘ç½‘ç»œè¯·æ±‚" âœ… "å·¥å…·ä¼˜å…ˆï¼šProfiler \>
LeakCanary \> TraceView \> Systrace"

æ˜¯å¦å¸Œæœ›æˆ‘ä¸‹ä¸€æ­¥å¸®ä½ ç”Ÿæˆä¸€ä»½ ğŸ‘‰ ã€Android æ€§èƒ½ä¼˜åŒ–ä»£ç æ¨¡æ¿åŒ…ã€‘
åŒ…å«å¯åŠ¨ä¼˜åŒ–ç±»ã€LeakCanary åˆå§‹åŒ–ç±»ã€StrictMode å·¥å…·ç±»ã€RecyclerView
ä¼˜åŒ–å°è£…ï¼Ÿ è¿™æ ·ä½ å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°é¡¹ç›®ä¸­ä½¿ç”¨ã€‚

éå¸¸å¥½çš„é—®é¢˜ ğŸ‘ "Android è·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰"
æ˜¯ç³»ç»Ÿåº•å±‚å’Œé«˜çº§å¼€å‘ï¼ˆå¦‚å¤šè¿›ç¨‹æ¶æ„ã€æ’ä»¶æ¡†æ¶ã€ç³»ç»ŸæœåŠ¡ï¼‰éƒ½ç¦»ä¸å¼€çš„çŸ¥è¯†ç‚¹ã€‚
ä¸‹é¢æˆ‘å¸®ä½ æ€»ç»“æœ€å…¨çš„å‡ ç§ IPCï¼ˆInter-Process Communicationï¼‰æ–¹å¼ ğŸ‘‡

ğŸ§© ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è·¨è¿›ç¨‹é€šä¿¡ï¼Ÿ

æ¯ä¸ª Android App éƒ½è¿è¡Œåœ¨ç‹¬ç«‹çš„ è¿›ç¨‹å’Œæ²™ç®± ä¸­ï¼š

ä¸åŒè¿›ç¨‹çš„æ•°æ®ã€å†…å­˜ç©ºé—´äº’ç›¸éš”ç¦»ã€‚

å¦‚æœæˆ‘ä»¬ï¼š

å¯åŠ¨äº†å¤šè¿›ç¨‹ï¼ˆandroid:process=":remote"ï¼‰ï¼›

æˆ–è¦å’Œå…¶ä»– App äº¤äº’ï¼ˆæ¯”å¦‚ç³»ç»Ÿè”ç³»äººã€æ”¯ä»˜æœåŠ¡ï¼‰ï¼›

å°±éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œè®©ä¸åŒè¿›ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€è°ƒç”¨æ–¹æ³•ï¼Œè¿™å°±æ˜¯
IPCï¼ˆè·¨è¿›ç¨‹é€šä¿¡ï¼‰ã€‚

âš™ï¸ äºŒã€Android è·¨è¿›ç¨‹é€šä¿¡çš„å¸¸è§æ–¹å¼æ€»è§ˆ

ğŸ§± ä¸‰ã€å„æ–¹å¼è¯¦ç»†è®²è§£

ğŸ”¹ 1ï¸âƒ£ Binderï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰

Android æ‰€æœ‰çš„ IPC éƒ½æ˜¯åŸºäº Binder å®ç°çš„ã€‚ åŒ…æ‹¬
AIDLã€Messengerã€ContentProviderã€ç³»ç»ŸæœåŠ¡ç­‰ã€‚

ğŸ“¦ ç‰¹ç‚¹ï¼š

é€Ÿåº¦å¿«ï¼ˆå†…æ ¸çº§å…±äº«å†…å­˜ï¼‰ï¼›

å®‰å…¨æ€§é«˜ï¼›

æ”¯æŒå¯¹è±¡å¼•ç”¨ï¼›

ç³»ç»Ÿæ ¸å¿ƒæœåŠ¡éƒ½åŸºäºå®ƒã€‚

ğŸ§° å®ç°æ–¹å¼ï¼š

è‡ªå®šä¹‰ AIDL æ¥å£ï¼›

ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ Stub / Proxyï¼›

Client è°ƒç”¨ Proxy â†’ Kernel Binder Driver â†’ Service Stubã€‚

ğŸ“Œ ä½¿ç”¨åœºæ™¯ï¼š

è·¨è¿›ç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆAIDLï¼‰ï¼›

ç³»ç»ŸæœåŠ¡ï¼ˆå¦‚ AMSã€WMSï¼‰ï¼›

å¤§å‹ App çš„å¤šè¿›ç¨‹æ¨¡å—é€šä¿¡ã€‚

ğŸ”¹ 2ï¸âƒ£ Messengerï¼ˆåŸºäº Binder å°è£…ï¼‰

ä¸€ç§è½»é‡çº§è·¨è¿›ç¨‹æ¶ˆæ¯é€šä¿¡æœºåˆ¶ï¼Œåº•å±‚ä»ç„¶æ˜¯ Binderã€‚

ğŸ§° ç”¨æ³•ç¤ºä¾‹ï¼š

// æœåŠ¡ç«¯

Handler handler = new Handler(msg -\> {

    Log.d("Server", "receive: " + msg.what);

    return true;

});

Messenger messenger = new Messenger(handler);

@Override

public IBinder onBind(Intent intent) { return messenger.getBinder(); }

// å®¢æˆ·ç«¯

Messenger client = new Messenger(serviceBinder);

Message msg = Message.obtain();

msg.what = 1;

client.send(msg);

ğŸ“¦ ç‰¹ç‚¹ï¼š

åªèƒ½ä¼  Messageï¼ˆè½»é‡æ¶ˆæ¯ï¼‰ï¼›

ä¸æ”¯æŒå¹¶å‘ã€å¤šæ¥å£ï¼›

å®ç°ç®€å•ï¼›

é€‚åˆå‘½ä»¤å¼é€šä¿¡ï¼ˆå¦‚"å¼€å§‹ä¸‹è½½"ã€"åœæ­¢æ’­æ”¾"ï¼‰ã€‚

ğŸ”¹ 3ï¸âƒ£ ContentProvider

é€šè¿‡ URI + ContentResolver å®ç°ä¸åŒè¿›ç¨‹çš„æ•°æ®å…±äº«ã€‚

ğŸ“¦ ç‰¹ç‚¹ï¼š

æ”¯æŒæ•°æ®åº“ã€æ–‡ä»¶è®¿é—®ï¼›

å¯é™åˆ¶æƒé™ï¼›

å¤©ç”Ÿæ”¯æŒè·¨è¿›ç¨‹ï¼›

ç³»ç»Ÿçº§ Provider éå¸¸å¤šï¼ˆè”ç³»äººã€åª’ä½“åº“ï¼‰ã€‚

ğŸ“Œ åœºæ™¯ï¼š

ä¸åŒ App ä¹‹é—´å…±äº«æ•°æ®ï¼›

æ–‡ä»¶å…±äº«ï¼ˆé€šè¿‡ FileProviderï¼‰ï¼›

æ¨¡å—é—´ç»Ÿä¸€æ•°æ®æ¥å£ã€‚

ğŸ”¹ 4ï¸âƒ£ BroadcastReceiver

ä¸€ç§"ä¸€å¯¹å¤š"çš„è·¨è¿›ç¨‹é€šä¿¡æ–¹å¼ã€‚

ğŸ“¦ ç‰¹ç‚¹ï¼š

æ— éœ€ç»‘å®šï¼›

æ”¯æŒç³»ç»Ÿå…¨å±€å¹¿æ’­ï¼›

æ”¯æŒè·¨è¿›ç¨‹ï¼›

ä½†å®æ—¶æ€§å·®ã€æ€§èƒ½ä½ã€‚

ğŸ“Œ åœºæ™¯ï¼š

ç³»ç»Ÿäº‹ä»¶ï¼ˆå¦‚ç½‘ç»œå˜åŒ–ã€ç”µé‡ã€å®‰è£…å¸è½½ï¼‰ï¼›

è‡ªå®šä¹‰å¹¿æ’­ï¼ˆæ¨¡å—é€šçŸ¥ï¼‰ã€‚

ğŸ”¹ 5ï¸âƒ£ Socket é€šä¿¡

åŸºäº TCP/UDP å®ç°ï¼Œå±äº"ç½‘ç»œå±‚"é€šä¿¡ã€‚

ğŸ“¦ ç‰¹ç‚¹ï¼š

å¯è·¨è®¾å¤‡ã€è·¨è¿›ç¨‹ï¼›

åŒå‘é€šä¿¡ï¼›

è‡ªå®šä¹‰åè®®ï¼›

æ¯” Binder æ…¢ï¼Œä½†æ›´çµæ´»ã€‚

ğŸ“Œ åœºæ™¯ï¼š

å³æ—¶é€šè®¯ï¼›

å±€åŸŸç½‘è®¾å¤‡äº¤äº’ï¼›

Android ä¸ PC é€šä¿¡ã€‚

ğŸ”¹ 6ï¸âƒ£ æ–‡ä»¶å…±äº« / SharedPreferences

å¤šè¿›ç¨‹å…±äº«åŒä¸€ä¸ªæ–‡ä»¶æˆ– XMLã€‚

ğŸ“¦ ç‰¹ç‚¹ï¼š

ç®€å•ï¼Œä½†åŒæ­¥éš¾ï¼›

éœ€åŠ é”ï¼›

ä¸æ”¯æŒå®æ—¶æ›´æ–°ï¼›

æ€§èƒ½å·®ã€‚

ğŸ“Œ åœºæ™¯ï¼š

ç®€å•çš„æ—¥å¿—å…±äº«ï¼›

ä¸´æ—¶çŠ¶æ€åŒæ­¥ã€‚

ğŸ”¹ 7ï¸âƒ£ ContentResolver + URI

å…¶å®å®ƒæ˜¯è®¿é—® ContentProvider çš„å…¥å£ã€‚ é€šè¿‡ç»Ÿä¸€çš„ URI åœ°å€ï¼Œè°ƒç”¨
query()/insert()/update()/delete()ï¼Œç³»ç»Ÿè‡ªåŠ¨å®Œæˆè·¨è¿›ç¨‹é€šä¿¡ã€‚

ğŸ”¹ 8ï¸âƒ£ ç¬¬ä¸‰æ–¹å°è£…ï¼ˆå¦‚ EventBus + Binderï¼‰

ä¸€äº›å¤§å‹æ¡†æ¶ï¼ˆå¦‚æ’ä»¶åŒ–æ¡†æ¶ã€çƒ­æ›´æ–°æ¡†æ¶ï¼‰ä¼šè‡ªå·±å°è£… IPC é€šé“ï¼Œæ¯”å¦‚ï¼š

HermesEventBusï¼ˆBinder + EventBusï¼‰ï¼›

ARouter æ”¯æŒè·¨è¿›ç¨‹é€šä¿¡ï¼›

MMKV / Messenger / gRPC æ··åˆä½¿ç”¨ã€‚

ğŸ” å››ã€æ€§èƒ½ä¸éš¾åº¦å¯¹æ¯”

ğŸ“¦ äº”ã€å®é™…å¼€å‘æ¨èç»„åˆ

âœ… å…­ã€ä¸€å¥è¯æ€»ç»“

ğŸ“œ Android æ‰€æœ‰çš„è·¨è¿›ç¨‹é€šä¿¡ï¼Œæœ¬è´¨éƒ½æ˜¯åŸºäº Binder å®ç°çš„ã€‚
åªä¸è¿‡ä¸Šå±‚å°è£…å‡ºäº†ä¸åŒçš„ä½¿ç”¨æ–¹å¼ï¼ˆAIDLã€Messengerã€Providerã€Broadcastï¼‰ã€‚

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ ç”»ä¸€å¼ ã€ŒAndroid è·¨è¿›ç¨‹é€šä¿¡æ–¹å¼æ€»è§ˆå›¾ã€ï¼Ÿ
åŒ…å«æ¯ç§æ–¹æ³•çš„è¿æ¥æ–¹å‘ã€ä¼˜ç¼ºç‚¹å’Œå…¸å‹ä½¿ç”¨åœºæ™¯ï¼Œæ¸…æ™°åˆå¥½è®°ã€‚

çº¿ç¨‹

éå¸¸å¥½ ğŸ‘ è¿™æ˜¯ Android é¢è¯•ä¸å®é™…å¼€å‘ä¸­éƒ½éå¸¸é‡è¦çš„ä¸€å— ------
å¤šçº¿ç¨‹ã€å¼‚æ­¥ã€å¹¶å‘ã€çº¿ç¨‹æ± æœºåˆ¶ã€‚ ä¸‹é¢æˆ‘ç»™ä½ ç³»ç»Ÿæ¢³ç†ä¸€éï¼ŒåŒ…æ‹¬ï¼š ğŸ‘‰
å¤šçº¿ç¨‹çš„å‡ ç§å®ç°æ–¹å¼ ğŸ‘‰ å¼‚æ­¥ä¸å¹¶å‘åŒºåˆ« ğŸ‘‰ çº¿ç¨‹æ± åˆ†ç±»ä¸ä½¿ç”¨ ğŸ‘‰
æ¯ç§éƒ½å¸¦ä¸Šæ¸…æ™°ä»£ç ä¾‹å­ã€‚

ğŸ§© ä¸€ã€Android ä¸­å¤šçº¿ç¨‹çš„å‡ ç§å®ç°æ–¹å¼

1ï¸âƒ£ ç»§æ‰¿ Thread ç±»

æœ€åŸºç¡€çš„æ–¹å¼ï¼Œç›´æ¥åˆ›å»ºçº¿ç¨‹ã€‚

class MyThread extends Thread {

    @Override

    public void run() {

        System.out.println("çº¿ç¨‹è¿è¡Œï¼š" + Thread.currentThread().getName());

    }

}

// ä½¿ç”¨

new MyThread().start();

ç‰¹ç‚¹ï¼š

ç®€å•æ˜“ç”¨ï¼›

ä¸ä¾¿äºæ‰©å±•ï¼ˆå› ä¸º Java å•ç»§æ‰¿ï¼‰ï¼›

ä¸æ–¹ä¾¿çº¿ç¨‹é—´å…±äº«èµ„æºã€‚

2ï¸âƒ£ å®ç° Runnable æ¥å£

æ¨èæ–¹å¼ï¼Œå¯å¤ç”¨é€»è¾‘ã€‚

Runnable task = new Runnable() {

    @Override

    public void run() {

        System.out.println("Runnableçº¿ç¨‹ï¼š" + Thread.currentThread().getName());

    }

};

new Thread(task).start();

ä¼˜ç‚¹ï¼š

å¯ä¸å…¶ä»–ç±»ç»§æ‰¿å…±å­˜ï¼›

å¯è¢«å¤šä¸ªçº¿ç¨‹å…±äº«æ‰§è¡Œï¼›

æ¨èå¸¸ç”¨ã€‚

3ï¸âƒ£ ä½¿ç”¨ Callable + Future

å¯è·å¾—çº¿ç¨‹è¿”å›ç»“æœï¼ˆRunnable æ²¡æœ‰è¿”å›å€¼ï¼‰ã€‚

Callable`<Integer>`{=html} task = new Callable`<Integer>`{=html}() {

    @Override

    public Integer call() throws Exception {

        Thread.sleep(1000);

        return 42;

    }

};

FutureTask`<Integer>`{=html} futureTask = new FutureTask\<\>(task);

new Thread(futureTask).start();

try {

    Integer result = futureTask.get(); // é˜»å¡ç­‰å¾…ç»“æœ

    System.out.println("ç»“æœ: " + result);

} catch (Exception e) {

    e.printStackTrace();

}

4ï¸âƒ£ ä½¿ç”¨ HandlerThreadï¼ˆAndroid ç‰¹æœ‰ï¼‰

å¸¦æœ‰æ¶ˆæ¯é˜Ÿåˆ—çš„çº¿ç¨‹ï¼Œå¯ä¸ Handler åä½œã€‚

HandlerThread handlerThread = new HandlerThread("MyHandlerThread");

handlerThread.start();

Handler handler = new Handler(handlerThread.getLooper());

handler.post(() -\> {

    Log.d("TAG", "åœ¨å­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡");

});

é€‚åˆåœºæ™¯ï¼š åå°é•¿æœŸä»»åŠ¡ï¼Œå¦‚æ—¥å¿—å†™å…¥ã€æ–‡ä»¶IOã€æ•°æ®åº“ç­‰ã€‚

5ï¸âƒ£ ä½¿ç”¨ AsyncTaskï¼ˆå·²è¿‡æ—¶ï¼Œä½†é¢è¯•å¸¸é—®ï¼‰

ä¸»è¦ç”¨äºæ›´æ–° UI + åå°ä»»åŠ¡ã€‚

class MyTask extends AsyncTask\<Void, Integer, String\> {

    @Override

    protected String doInBackground(Void... voids) {

        // å­çº¿ç¨‹æ‰§è¡Œ

        return "ä»»åŠ¡å®Œæˆ";

    }



    @Override

    protected void onPostExecute(String result) {

        // ä¸»çº¿ç¨‹æ›´æ–° UI

        Log.d("TAG", result);

    }

}

new MyTask().execute();

âœ… æ–°é¡¹ç›®æ¨èä½¿ç”¨ Kotlin Coroutine æˆ– WorkManager æ›¿ä»£ã€‚

6ï¸âƒ£ ä½¿ç”¨ ExecutorServiceï¼ˆçº¿ç¨‹æ± ï¼‰

çº¿ç¨‹æ± ç®¡ç†å¤šçº¿ç¨‹ä»»åŠ¡ã€‚

ExecutorService executor = Executors.newFixedThreadPool(3);

for (int i = 0; i \< 5; i++) {

    int finalI = i;

    executor.execute(() -> {

        Log.d("TAG", "ä»»åŠ¡ " + finalI + " åœ¨çº¿ç¨‹ï¼š" + Thread.currentThread().getName());

    });

}

executor.shutdown();

âš™ï¸ äºŒã€å¼‚æ­¥ vs å¹¶å‘

ğŸ‘‰ å¼‚æ­¥ â‰  å¹¶å‘ï¼šå¼‚æ­¥æ˜¯ä¸€ç§æ‰§è¡Œç­–ç•¥ï¼Œå¹¶å‘æ˜¯æ‰§è¡Œèƒ½åŠ›ã€‚

ğŸš€ ä¸‰ã€çº¿ç¨‹æ± ï¼ˆThreadPoolExecutorï¼‰

å¸¸è§ç±»å‹ï¼š

è‡ªå®šä¹‰çº¿ç¨‹æ± 

ThreadPoolExecutor executor = new ThreadPoolExecutor(

        2,        // corePoolSize

        4,        // maximumPoolSize

        60,       // keepAliveTime

        TimeUnit.SECONDS,

        new LinkedBlockingQueue<>(10), // ä»»åŠ¡é˜Ÿåˆ—

        Executors.defaultThreadFactory(),

        new ThreadPoolExecutor.AbortPolicy() // æ‹’ç»ç­–ç•¥

);

ğŸ§  å››ã€Android å¸¸ç”¨å¼‚æ­¥æ–¹æ¡ˆæ€»ç»“

ğŸŒˆ æ€»ç»“ä¸€å¥è¯ï¼š

Android å¤šçº¿ç¨‹çš„æ ¸å¿ƒæ˜¯ï¼š åˆç†ä½¿ç”¨å¼‚æ­¥ï¼ˆä¸é˜»å¡ä¸»çº¿ç¨‹ï¼‰+ å¹¶å‘ï¼ˆæå‡æ€§èƒ½ï¼‰+
çº¿ç¨‹æ± ï¼ˆæ§åˆ¶èµ„æºï¼‰ã€‚

æ˜¯å¦è¦æˆ‘å¸®ä½ ç”»ä¸€å¼ ã€Android å¤šçº¿ç¨‹ä¸å¼‚æ­¥æœºåˆ¶æ€ç»´å¯¼å›¾ï¼ˆå›¾ç‰‡ç‰ˆï¼‰ã€‘ï¼ŒåŒ…æ‹¬ï¼š

æ‰€æœ‰å®ç°æ–¹å¼

å¼‚æ­¥ vs å¹¶å‘åŒºåˆ«

çº¿ç¨‹æ± åˆ†ç±»ç»“æ„ ä¸€å›¾æ€»ç»“æ•´ä¸ªçŸ¥è¯†ä½“ç³»ï¼Ÿ
